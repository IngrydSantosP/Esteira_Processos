
{% extends "base.html" %}

{% block title %}{{ vaga.titulo }} - Detalhes da Vaga{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-purple-50 via-blue-50 to-indigo-50 py-8">
    <div class="max-w-4xl mx-auto px-4">
        <!-- Header Aprimorado -->
        <div class="mb-8">
            <div class="flex items-center justify-between mb-6">
                <a href="{{ url_for('dashboard_candidato') }}" 
                   class="inline-flex items-center gap-2 bg-purple-100 hover:bg-purple-200 text-purple-700 hover:text-purple-800 font-semibold px-4 py-2 rounded-xl transition-all duration-300 transform hover:scale-105">
                    <span class="text-lg">⬅️</span> Voltar ao Dashboard
                </a>
                
                {% if score %}
                <div class="bg-gradient-to-r from-green-500 to-emerald-500 text-white px-6 py-3 rounded-2xl font-bold text-lg shadow-lg">
                    <span class="text-xl">🎯</span> {{ "%.0f"|format(score) }}% de Compatibilidade
                </div>
                {% endif %}
            </div>
            
            <div class="bg-white rounded-3xl p-8 shadow-xl border border-gray-100">
                <div class="flex items-start gap-8">
                    <div class="w-24 h-24 bg-gradient-to-br from-purple-500 via-blue-500 to-indigo-500 rounded-3xl flex items-center justify-center flex-shrink-0 shadow-lg transform -rotate-3 hover:rotate-0 transition-transform duration-300">
                        <span class="text-4xl">💼</span>
                    </div>
                    <div class="flex-1">
                        <h1 class="text-4xl font-bold bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent mb-4">{{ vaga.titulo }}</h1>
                        <div class="flex flex-wrap gap-4 mb-6">
                            <span class="flex items-center gap-2 bg-gradient-to-r from-purple-100 to-purple-200 text-purple-800 px-4 py-2 rounded-full font-semibold shadow-sm">
                                <span class="text-lg">🏢</span> {{ vaga.titulo}}
                            </span>
                            <span class="flex items-center gap-2 bg-gradient-to-r from-green-100 to-emerald-200 text-green-800 px-4 py-2 rounded-full font-semibold shadow-sm">
                                <span class="text-lg">💰</span> R$ {{ "{:,.2f}".format(vaga.salario_oferecido) }}
                            </span>
                            <span class="flex items-center gap-2 bg-gradient-to-r from-blue-100 to-indigo-200 text-blue-800 px-4 py-2 rounded-full font-semibold shadow-sm">
                                <span class="text-lg">📍</span> {{ vaga.tipo_vaga }}
                            </span>
                        </div>
                        
                        {% if vaga.endereco_vaga and vaga.tipo_vaga in ['Presencial', 'Híbrida'] %}
                        <div class="flex items-center gap-3 text-gray-700 mb-4 bg-gray-50 px-4 py-3 rounded-xl border border-gray-200">
                            <span class="text-xl">🗺️</span>
                            <span class="font-medium">{{ vaga.endereco_vaga }}</span>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <div class="grid gap-8 lg:grid-cols-3">
            <!-- Coluna Principal -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Descrição -->
                <div class="bg-white rounded-3xl p-8 shadow-lg border border-gray-100 hover:shadow-xl transition-shadow duration-300">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-3">
                        <div class="w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center">
                            <span class="text-xl">📝</span>
                        </div>
                        Sobre esta Oportunidade
                    </h2>
                    <div class="text-gray-700 leading-relaxed whitespace-pre-wrap text-base">{{ vaga.descricao }}</div>
                </div>

                <!-- Requisitos -->
                <div class="bg-white rounded-3xl p-8 shadow-lg border border-gray-100 hover:shadow-xl transition-shadow duration-300">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-3">
                        <div class="w-10 h-10 bg-orange-100 rounded-xl flex items-center justify-center">
                            <span class="text-xl">⚡</span>
                        </div>
                        Requisitos Essenciais
                    </h2>
                    <div class="text-gray-700 leading-relaxed whitespace-pre-wrap text-base">{{ vaga.requisitos }}</div>
                </div>

                {% if score %}
                <!-- Detalhamento do Score -->
                <div class="bg-gradient-to-br from-indigo-50 via-blue-50 to-purple-50 rounded-3xl p-8 border border-indigo-200 shadow-lg">
                    <h2 class="text-2xl font-bold text-indigo-800 mb-6 flex items-center gap-3">
                        <div class="w-12 h-12 bg-indigo-100 rounded-xl flex items-center justify-center">
                            <span class="text-2xl">📊</span>
                        </div>
                        Análise da Sua Compatibilidade
                    </h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-white rounded-2xl p-5 shadow-md border border-gray-100">
                            <h4 class="font-bold text-gray-800 mb-2 flex items-center gap-2">
                                <span class="text-lg">💰</span> Compatibilidade Salarial
                            </h4>
                            <div class="text-sm text-gray-600 mb-2">Peso: 20% da análise</div>
                            <p class="text-sm text-gray-700">Baseado na sua pretensão salarial vs. salário oferecido</p>
                        </div>
                        
                        <div class="bg-white rounded-2xl p-5 shadow-md border border-gray-100">
                            <h4 class="font-bold text-gray-800 mb-2 flex items-center gap-2">
                                <span class="text-lg">⚡</span> Requisitos Técnicos
                            </h4>
                            <div class="text-sm text-gray-600 mb-2">Peso: 40% da análise</div>
                            <p class="text-sm text-gray-700">Compatibilidade entre suas habilidades e os requisitos da vaga</p>
                        </div>
                        
                        <div class="bg-white rounded-2xl p-5 shadow-md border border-gray-100">
                            <h4 class="font-bold text-gray-800 mb-2 flex items-center gap-2">
                                <span class="text-lg">🎓</span> Experiência Profissional
                            </h4>
                            <div class="text-sm text-gray-600 mb-2">Peso: 15% da análise</div>
                            <p class="text-sm text-gray-700">Nível de senioridade e anos de experiência</p>
                        </div>
                        
                        <div class="bg-white rounded-2xl p-5 shadow-md border border-gray-100">
                            <h4 class="font-bold text-gray-800 mb-2 flex items-center gap-2">
                                <span class="text-lg">⭐</span> Diferenciais
                            </h4>
                            <div class="text-sm text-gray-600 mb-2">Peso: 10% da análise</div>
                            <p class="text-sm text-gray-700">Certificações e habilidades extras que você possui</p>
                        </div>
                        
                        <div class="bg-white rounded-2xl p-5 shadow-md border border-gray-100">
                            <h4 class="font-bold text-gray-800 mb-2 flex items-center gap-2">
                                <span class="text-lg">📍</span> Localização
                            </h4>
                            <div class="text-sm text-gray-600 mb-2">Peso: 10% da análise</div>
                            <p class="text-sm text-gray-700">Proximidade geográfica e modalidade da vaga</p>
                        </div>
                        
                        <div class="bg-white rounded-2xl p-5 shadow-md border border-gray-100">
                            <h4 class="font-bold text-gray-800 mb-2 flex items-center gap-2">
                                <span class="text-lg">🎓</span> Formação Acadêmica
                            </h4>
                            <div class="text-sm text-gray-600 mb-2">Peso: 5% da análise</div>
                            <p class="text-sm text-gray-700">Nível educacional e área de formação</p>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>

            <!-- Sidebar -->
            <div class="space-y-6">
                <!-- Empresa -->
                <div class="bg-white rounded-3xl p-6 shadow-lg border border-gray-100">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-3">
                        <div class="w-10 h-10 bg-purple-100 rounded-xl flex items-center justify-center">
                            <span class="text-lg">🏢</span>
                        </div>
                        Sobre a Empresa
                    </h3>
                    <div class="text-gray-700">
                        <p class="font-bold text-purple-600 mb-3 text-lg">{{vaga.titulo}}</p>
                        <p class="text-gray-600 leading-relaxed">
                            Empresa focada em inovação e desenvolvimento de soluções tecnológicas modernas e escaláveis.
                        </p>
                    </div>
                </div>

                <!-- Ações -->
                <div class="bg-white rounded-3xl p-6 shadow-lg border border-gray-100">
                    {% if ja_candidatado %}
                        <div class="text-center">
                            <div class="w-20 h-20 bg-green-100 rounded-2xl mx-auto mb-4 flex items-center justify-center">
                                <span class="text-3xl">✅</span>
                            </div>
                            <h4 class="font-bold text-green-700 mb-2 text-lg">Candidatura Enviada!</h4>
                            <p class="text-sm text-gray-600 mb-6 bg-green-50 p-3 rounded-lg border border-green-200">
                                🎯 Acompanhe o andamento da sua candidatura no dashboard
                            </p>
                            <button onclick="cancelarCandidatura({{ vaga.id }})"
                                    class="w-full bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white py-4 px-6 rounded-2xl font-bold transition-all duration-300 transform hover:scale-105 shadow-lg flex items-center justify-center gap-2">
                                <span class="text-lg">❌</span>
                                Cancelar Candidatura
                            </button>
                        </div>
                    {% else %}
                        <a href="{{ url_for('candidatar', vaga_id=vaga.id) }}" 
                           class="block w-full bg-gradient-to-r from-green-600 via-emerald-600 to-teal-600 hover:from-green-700 hover:via-emerald-700 hover:to-teal-700 text-white font-bold py-5 px-6 rounded-2xl text-center transition-all duration-300 transform hover:scale-105 shadow-xl">
                            <span class="flex items-center justify-center gap-3 text-lg">
                                <span class="text-2xl">🚀</span>
                                Candidatar-se Agora
                            </span>
                        </a>
                    {% endif %}
                </div>

                <!-- Informações Adicionais -->
                <div class="bg-gradient-to-br from-indigo-50 via-blue-50 to-purple-50 rounded-3xl p-6 border border-indigo-200 shadow-lg">
                    <h4 class="font-bold text-indigo-800 mb-4 flex items-center gap-2">
                        <span class="text-lg">ℹ️</span> Detalhes da Oportunidade
                    </h4>
                    <div class="space-y-4">
                        <div class="bg-white rounded-xl p-4 shadow-sm">
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600 flex items-center gap-2">
                                    <span>🏠</span> Modalidade:
                                </span>
                                <span class="font-bold text-gray-800">{{ vaga.tipo_vaga }}</span>
                            </div>
                        </div>
                        <div class="bg-white rounded-xl p-4 shadow-sm">
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600 flex items-center gap-2">
                                    <span>💰</span> Salário:
                                </span>
                                <span class="font-bold text-green-600 text-lg">R$ {{ "{:,.2f}".format(vaga.salario_oferecido) }}</span>
                            </div>
                        </div>
                        <div class="bg-white rounded-xl p-4 shadow-sm">
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600 flex items-center gap-2">
                                    <span>📅</span> Publicada em:
                                </span>
                                <span class="font-bold text-gray-800">{{ vaga.data_criacao.strftime('%d/%m/%Y') if vaga.data_criacao else 'N/A' }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
async function cancelarCandidatura(vagaId) {
    if (confirm('🤔 Tem certeza que deseja cancelar sua candidatura para esta vaga?')) {
        try {
            const response = await fetch('/cancelar_candidatura', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    vaga_id: vagaId
                })
            });

            if (response.ok) {
                alert('✅ Candidatura cancelada com sucesso!');
                window.location.href = '{{ url_for("dashboard_candidato") }}';
            } else {
                alert('❌ Erro ao cancelar candidatura');
            }
        } catch (error) {
            console.error('Erro:', error);
            alert('❌ Erro ao cancelar candidatura');
        }
    }
}
</script>
{% endblock %}
