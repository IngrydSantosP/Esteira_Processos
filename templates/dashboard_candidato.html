{% extends "base.html" %}

{% block title %}Dashboard - Candidato{% endblock %}

{% block content %}

<style>
    .icone-contratado { color: #16a34a; font-size: 1.2em; margin-right: 8px; }
    .icone-nao-lida { color: red; font-size: 1em; margin-right: 8px; }
    .icone-congelada { color: #3b82f6; font-size: 1.2em; margin-right: 8px; }
    .icone-excluida { color: #ef4444; font-size: 1.2em; margin-right: 8px; }
    .filter-active {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }
    .notification-dot {
        animation: pulse 2s infinite;
    }
    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
    }
    .favorite-btn:hover .tooltiptext {
        visibility: visible;
        opacity: 1;
    }
    .favorite-btn .tooltiptext {
        visibility: hidden;
        width: 120px;
        background-color: #555;
        color: #fff;
        text-align: center;
        border-radius: 6px;
        padding: 5px 0;
        position: absolute;
        z-index: 1;
        bottom: 125%;
        left: 50%;
        margin-left: -60px;
        opacity: 0;
        transition: opacity 0.3s;
    }
</style>

<div class="min-h-screen bg-gradient-to-br from-purple-50 via-blue-50 to-indigo-50">
    <!-- Header da pÃ¡gina -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-6">
        <div class="flex flex-col lg:flex-row lg:justify-between lg:items-center gap-4 lg:gap-0 mb-6 lg:mb-8">
            <div class="flex items-center space-x-3">
                <div class="w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-r from-purple-500 to-blue-500 rounded-xl flex items-center justify-center">
                    <span class="text-white font-bold text-base sm:text-lg">ğŸ‘‹</span>
                </div>
                <div>
                    <h1 class="text-xl sm:text-2xl font-bold bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent">
                        Meu Dashboard
                    </h1>
                    <p class="text-gray-500 text-xs sm:text-sm">Gerencie suas candidaturas e explore oportunidades</p>
                </div>
            </div>
            <div class="flex flex-wrap gap-2 sm:gap-3 items-center justify-center sm:justify-end">
                <button onclick="showSection('favoritas')" 
                        class="bg-white hover:bg-gray-50 text-gray-700 w-10 h-10 sm:w-12 sm:h-12 rounded-xl flex items-center justify-center border border-gray-200 shadow transition-all duration-300"
                        aria-label="Ver vagas favoritas">
                    <span class="text-lg sm:text-xl">â­</span>
                </button>
                
                <!-- BotÃ£o: Editar perfil -->
                <a href="{{ url_for('editar_perfil_candidato') }}"
                   class="bg-white hover:bg-gray-50 text-gray-700 w-10 h-10 sm:w-12 sm:h-12 rounded-xl flex items-center justify-center border border-gray-200 shadow transition-all duration-300"
                   aria-label="Editar informaÃ§Ãµes do perfil">
                  <span class="text-lg sm:text-xl">âš™ï¸</span>
                </a>

             <!-- BotÃ£o de NotificaÃ§Ãµes Melhorado -->
                <div class="relative">
                    <button id="btnNotificacoes" onclick="toggleNotificacoes()"
                            class="relative p-3 bg-gradient-to-r from-purple-500 to-blue-500 text-white rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105 group">
                        <span class="text-xl transition-transform group-hover:animate-bounce">ğŸ””</span>
                        <span id="badgeNotificacoes" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full min-w-[20px] h-5 flex items-center justify-center font-bold animate-pulse hidden">0</span>
                        <span id="notificationDot" class="absolute -top-1 -right-1 w-2 h-2 bg-red-500 rounded-full hidden"></span>
                    </button>

                    <!-- Painel de NotificaÃ§Ãµes Melhorado -->
                    <div id="painelNotificacoes" class="absolute right-0 top-16 w-96 bg-white rounded-2xl shadow-2xl border border-gray-100 z-50 hidden overflow-hidden">
                        <!-- Header do painel -->
                        <div class="bg-gradient-to-r from-purple-500 to-blue-500 text-white p-4">
                            <div class="flex justify-between items-center">
                                <div class="flex items-center gap-2">
                                    <span class="text-xl">ğŸ””</span>
                                    <h3 class="font-bold text-lg">NotificaÃ§Ãµes</h3>
                                </div>
                                <div class="flex gap-2">
                                    <button onclick="marcarTodasComoLidas()"
                                            class="text-xs bg-white/20 hover:bg-white/30 px-3 py-1 rounded-full transition-all duration-200">
                                        âœ“ Marcar todas
                                    </button>
                                    <button onclick="apagarTodasNotificacoes()"
                                            class="text-xs bg-red-500/20 hover:bg-red-500/30 px-3 py-1 rounded-full transition-all duration-200">
                                        ğŸ—‘ï¸ Limpar
                                    </button>
                                </div>
                            </div>
                            <div id="contadorNotificacoes" class="text-sm opacity-90 mt-1">
                                0 notificaÃ§Ãµes
                            </div>
                        </div>

                        <!-- Lista de notificaÃ§Ãµes -->
                        <div id="listaNotificacoes" class="max-h-96 overflow-y-auto">
                            <div id="notificacoesVazias" class="p-8 text-center text-gray-500">
                                <div class="mb-4">
                                    <span class="text-6xl opacity-50">ğŸ“­</span>
                                </div>
                                <p class="text-lg font-medium mb-2">Nenhuma notificaÃ§Ã£o</p>
                                <p class="text-sm">VocÃª estÃ¡ em dia! ğŸ‰</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="max-w-7xl mx-auto px-4 py-8">
        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100 hover:shadow-md transition-all duration-300 hover:border-purple-200">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm font-medium">Candidaturas</p>
                        <p class="text-3xl font-bold text-purple-600">{{ vagas_candidatadas|length if vagas_candidatadas else 0 }}</p>
                    </div>
                    <div class="w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center">
                        <span class="text-2xl">ğŸ¯</span>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100 hover:shadow-md transition-all duration-300 hover:border-green-200">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm font-medium">Vagas DisponÃ­veis</p>
                        <p class="text-3xl font-bold text-green-600">{{ vagas_recomendadas|length if vagas_recomendadas else 0 }}</p>
                    </div>
                    <div class="w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center">
                        <span class="text-2xl">ğŸ’¼</span>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100 hover:shadow-md transition-all duration-300 hover:border-blue-200">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm font-medium">Match MÃ©dio</p>
                        <p class="text-3xl font-bold text-blue-600">
                            {% if vagas_candidatadas %}
                                {{ "%.0f"|format(vagas_candidatadas|map(attribute=4)|sum / vagas_candidatadas|length) }}%
                            {% else %}
                                0%
                            {% endif %}
                        </p>
                    </div>
                    <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center">
                        <span class="text-2xl">ğŸ”¢</span>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100 hover:shadow-md transition-all duration-300 hover:border-yellow-200">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm font-medium">Favoritas</p>
                        <p class="text-3xl font-bold text-yellow-600">{{ vagas_favoritas|length if vagas_favoritas else 0 }}</p>
                    </div>
                    <div class="w-12 h-12 bg-yellow-100 rounded-xl flex items-center justify-center">
                        <span class="text-2xl">â­</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Filtros -->
        <div class="mb-8">
            <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
                <div class="flex flex-wrap gap-3 justify-center">
                    <button onclick="showSection('principais')" class="filter-btn filter-active px-6 py-3 rounded-xl font-semibold transition-all duration-300 transform hover:scale-105">
                        ğŸ† Principais
                    </button>
                    <button onclick="showSection('todas')" class="filter-btn bg-gray-100 text-gray-700 px-6 py-3 rounded-xl font-medium transition-all duration-300 transform hover:scale-105">
                        ğŸ“‹ Todas as Vagas
                    </button>
                    <button onclick="showSection('candidaturas')" class="filter-btn bg-gray-100 text-gray-700 px-6 py-3 rounded-xl font-medium transition-all duration-300 transform hover:scale-105">
                        ğŸ¯ Minhas Candidaturas
                    </button>
                    <button onclick="showSection('assistente-ia')" class="filter-btn bg-gray-100 text-gray-700 px-6 py-3 rounded-xl font-medium transition-all duration-300 transform hover:scale-105">
                        ğŸ¤– Assistente IA
                    </button>
                </div>
            </div>
        </div>

        <!-- SeÃ§Ã£o Principais -->
        <div id="section-principais" class="content-section">
            <div id="principaisVagasContainer">
                {% if vagas_recomendadas %}
                <div>
                    <div class="text-center mb-8">
                        <h2 class="text-3xl font-bold bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent mb-3">
                            Vagas Recomendadas Para VocÃª
                        </h2>
                        <p class="text-gray-600 bg-white px-6 py-3 rounded-full inline-block shadow-sm border border-gray-100">
                            â­ Top {{ vagas_recomendadas|length }} vagas compatÃ­veis com seu perfil
                        </p>
                    </div>

                    <div class="grid gap-6">
                        {% for vaga in vagas_recomendadas %}
                        <div class="group bg-white rounded-3xl p-8 shadow-lg border border-gray-100 hover:shadow-2xl hover:border-purple-200 transition-all duration-500 transform hover:-translate-y-1 overflow-hidden relative">
                            <!-- Gradiente decorativo no topo -->
                            <div class="absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-purple-500 via-blue-500 to-emerald-500"></div>
                                <div class="flex flex-col lg:flex-row gap-8">
                                <div class="flex-1">
                                    <div class="flex items-start gap-6 mb-6">
                                        <div class="relative">
                                            <div class="w-20 h-20 bg-gradient-to-br from-purple-100 to-blue-100 rounded-2xl flex items-center justify-center flex-shrink-0 group-hover:scale-110 transition-all duration-300">
                                                <span class="text-3xl">ğŸ’¼</span>
                                            </div>
                                        </div>

                                        <div class="flex-1">
                                            <div class="flex items-center gap-3 mb-3">
                                                <a href="{{ url_for('detalhes_vaga', vaga_id=vaga[0]) }}" class="block">
                                                    <h3 class="text-2xl font-bold text-gray-800 group-hover:text-purple-600 transition-colors">
                                                        {{ vaga[1] }}
                                                    </h3>
                                                </a>
                                                <button onclick="toggleFavorite({{ vaga[0] }}, this)"
                                                        class="relative favorite-btn text-2xl transition-all duration-300 hover:scale-125 {{ 'text-yellow-400' if vaga[10] else 'text-gray-300' }}"
                                                        data-favorited="{{ 'true' if vaga[10] else 'false' }}">
                                                    {{ 'â­' if vaga[10] else 'â˜†' }}
                                                    <span class="tooltiptext">
                                                        {% if vaga[10] %}Remover dos favoritos{% else %}Adicionar aos favoritos{% endif %}
                                                    </span>
                                                </button>
                                            </div>

                                            <div class="flex flex-wrap gap-3 mb-4">
                                                <span class="inline-flex items-center gap-2 bg-purple-100 text-purple-700 px-3 py-1 rounded-full text-sm font-semibold">
                                                    ğŸ¢ {{ vaga[5] }}
                                                </span>
                                                <span class="inline-flex items-center gap-2 bg-green-100 text-green-700 px-3 py-1 rounded-full text-sm font-bold">
                                                    ğŸ’° R$ {{ "%.2f"|format(vaga[4]) }}
                                                </span>
                                                {% if vaga[7] %}
                                                <span class="inline-flex items-center gap-2 bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-sm font-medium">
                                                    ğŸŒ {{ vaga[7] }}
                                                </span>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>

                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                                        <div class="bg-gradient-to-r from-gray-50 to-blue-50 p-4 rounded-2xl border border-gray-100">
                                            <p class="text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2">
                                                <span class="w-6 h-6 bg-blue-500 rounded-lg flex items-center justify-center text-white text-xs">ğŸ“</span>
                                                DescriÃ§Ã£o
                                            </p>
                                            <p class="text-sm text-gray-600 leading-relaxed">{{ vaga[2][:150] }}{% if vaga[2]|length > 150 %}...{% endif %}</p>
                                        </div>
                                        <div class="bg-gradient-to-r from-purple-50 to-pink-50 p-4 rounded-2xl border border-purple-100">
                                            <p class="text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2">
                                                <span class="w-6 h-6 bg-purple-500 rounded-lg flex items-center justify-center text-white text-xs">âš¡</span>
                                                Requisitos
                                            </p>
                                            <p class="text-sm text-gray-600 leading-relaxed">{{ vaga[3][:150] }}{% if vaga[3]|length > 150 %}...{% endif %}</p>
                                        </div>
                                    </div>
                                </div>

                                <div class="flex flex-col items-center justify-center lg:w-56 gap-6">
                                    <div class="text-center bg-gradient-to-br from-green-400 via-emerald-500 to-teal-500 text-white p-6 rounded-3xl shadow-xl transform group-hover:scale-105 transition-all duration-300">
                                        <div class="text-3xl font-bold mb-2">{{ "%.0f"|format(vaga[9]) }}%</div>
                                        <p class="text-sm font-semibold opacity-90">MATCH</p>
                                        <div class="w-full bg-white bg-opacity-30 rounded-full h-2 mt-3">
                                            <div class="bg-white h-2 rounded-full transition-all duration-1000" style="width: {{ vaga[9] }}%"></div>
                                        </div>
                                    </div>

                                    <div class="flex flex-col gap-3 w-full">
                                        <a href="{{ url_for('candidatar', vaga_id=vaga[0]) }}"
                                           class="group/btn bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white font-bold px-6 py-4 rounded-2xl shadow-lg transition-all duration-300 transform hover:scale-105 hover:shadow-xl flex items-center justify-center gap-3">
                                            <span class="transition-transform group-hover/btn:rotate-12">ğŸš€</span>
                                            Candidatar-se
                                        </a>

                                        <a href="{{ url_for('detalhes_vaga', vaga_id=vaga[0]) }}"
                                           class="bg-white hover:bg-gray-50 text-gray-700 border border-gray-200 font-semibold px-6 py-3 rounded-2xl transition-all duration-300 transform hover:scale-105 flex items-center justify-center gap-2">
                                            <span>ğŸ‘ï¸</span>
                                            Ver Detalhes
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% else %}
                <div class="text-center py-12 bg-white rounded-3xl shadow-lg border border-gray-100">
                    <div class="w-32 h-32 bg-gradient-to-br from-gray-100 to-blue-100 rounded-full mx-auto mb-8 flex items-center justify-center">
                        <span class="text-6xl">ğŸ”</span>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-600 mb-4">Nenhuma vaga disponÃ­vel no momento</h3>
                    <p class="text-gray-500 mb-8 max-w-md mx-auto">Complete seu perfil para receber melhores recomendaÃ§Ãµes e aumentar suas chances!</p>
                    <a href="{{ url_for('editar_perfil_candidato') }}"
                       class="bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white px-8 py-4 rounded-xl font-semibold transition-all duration-300 transform hover:scale-105 inline-flex items-center gap-3">
                        <span>âš™ï¸</span>
                        Completar Perfil
                    </a>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- SeÃ§Ã£o Todas -->
        <div id="section-todas" class="content-section hidden">

            <!-- Filtros de Busca dentro de Todas as Vagas -->
            <div class="bg-white rounded-3xl p-6 shadow-lg border border-gray-100 mb-8">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-xl font-bold text-gray-800 flex items-center gap-3">
                        <span class="w-8 h-8 bg-purple-100 rounded-xl flex items-center justify-center">ğŸ”</span>
                        Busca AvanÃ§ada
                    </h3>
                    <button id="toggleSearchBtnTodas" onclick="toggleAdvancedSearchTodas()"
                            class="group bg-gradient-to-r from-purple-500 to-blue-500 hover:from-purple-600 hover:to-blue-600 text-white p-3 rounded-xl transition-all duration-300 transform hover:scale-105 hover:shadow-lg">
                        <span id="searchIconTodas" class="text-xl transition-transform group-hover:rotate-12">ğŸ”</span>
                    </button>
                </div>

                <!-- Busca AvanÃ§ada (inicialmente oculta) -->
                <div id="advancedSearchPanelTodas" class="hidden space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">ğŸ” Palavra-chave</label>
                            <input type="text" id="searchKeyword" placeholder="Ex: desenvolvedor, marketing..."
                                   class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-300">
                        </div>

                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">ğŸ“ LocalizaÃ§Ã£o</label>
                            <select id="searchLocation" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-300">
                                <option value="">Qualquer localizaÃ§Ã£o</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">ğŸ·ï¸ Categoria</label>
                            <select id="searchCategory" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-300">
                                <option value="">Todas as categorias</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">ğŸ’° SalÃ¡rio mÃ­nimo</label>
                            <input type="number" id="searchSalary" placeholder="Ex: 5000" min="0" step="500"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-300">
                        </div>
                    </div>

                    <!-- Segunda linha de filtros -->
                    <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">ğŸ  Modalidade</label>
                            <select id="searchType" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-300">
                                <option value="">Qualquer modalidade</option>
                                <option value="Remoto">ğŸ  Remoto</option>
                                <option value="Presencial">ğŸ¢ Presencial</option>
                                <option value="HÃ­brida">ğŸ”„ HÃ­brida</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">âš¡ UrgÃªncia</label>
                            <select id="searchUrgency" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-300">
                                <option value="">Qualquer urgÃªncia</option>
                                <option value="Imediata">ğŸš¨ Imediata</option>
                                <option value="Em atÃ© 30 dias">â° 30 dias</option>
                                <option value="Em atÃ© 60 dias">ğŸ“… 60 dias</option>
                                <option value="Sem urgÃªncia">ğŸ• Sem urgÃªncia</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">ğŸ¯ Compatibilidade</label>
                            <select id="searchMatch" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-300">
                                <option value="">Qualquer match</option>
                                <option value="90">ğŸ”¥ 90%+ (Excelente)</option>
                                <option value="80">â­ 80%+ (Muito Bom)</option>
                                <option value="70">ğŸ‘ 70%+ (Bom)</option>
                                <option value="60">ğŸ“ 60%+ (BÃ¡sico)</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">â¤ï¸ Status</label>
                            <select id="searchStatus" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-300">
                                <option value="">Todas as vagas</option>
                                <option value="nao_candidatado">ğŸ“‹ Ainda nÃ£o me candidatei</option>
                                <option value="favoritas">â¤ï¸ Apenas favoritas</option>
                                <option value="nao_favoritas">ğŸ¤ NÃ£o favoritas</option>
                            </select>
                        </div>
                    </div>


                    <div class="flex gap-3 pt-4">
                        <button onclick="realizarBusca()"
                                class="group bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white px-6 py-3 rounded-xl font-semibold transition-all duration-300 transform hover:scale-105 flex items-center gap-2">
                            <span class="transition-transform group-hover:rotate-12">ğŸ”</span>
                            Buscar Vagas
                        </button>
                        <button onclick="limparFiltros()"
                                class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-6 py-3 rounded-xl font-semibold transition-all duration-300 transform hover:scale-105 flex items-center gap-2">
                            <span>ğŸ§¹</span>
                            Limpar Filtros
                        </button>
                    </div>
                </div>
            </div>

            <!-- Resultados -->
            <div id="todasVagasContainer">
                <div class="text-center py-8">
                    <div class="animate-spin w-8 h-8 border-4 border-purple-500 border-t-transparent rounded-full mx-auto mb-4"></div>
                    <p class="text-gray-500">Carregando vagas...</p>
                </div>
            </div>
        </div>

        <!-- SeÃ§Ã£o Candidaturas -->
        <div id="section-candidaturas" class="content-section hidden">
            {% if vagas_candidatadas %}
            <div>
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold text-gray-800 flex items-center gap-3">
                        <span class="w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center">ğŸ¯</span>
                        Suas Candidaturas
                    </h2>
                    <span class="bg-purple-100 text-purple-700 px-3 py-1 rounded-full text-sm font-medium">
                        {{ vagas_candidatadas|length }} ativa{{ 's' if vagas_candidatadas|length != 1 else '' }}
                    </span>
                </div>

                <div class="grid gap-6">
                    {% for vaga in vagas_candidatadas %}
                    <div class="group bg-white rounded-2xl p-6 shadow-sm border border-gray-100 hover:shadow-xl hover:border-purple-200 transition-all duration-300 transform hover:-translate-y-1">
                        <div class="flex flex-col lg:flex-row lg:items-center justify-between gap-4">
                            <div class="flex-1">
                                <div class="flex items-start gap-4">
                                    <div class="w-16 h-16 bg-gradient-to-br from-purple-100 to-blue-100 rounded-xl flex items-center justify-center flex-shrink-0">
                                        <span class="text-2xl">ğŸ¢</span>
                                    </div>
                                    <div class="flex-1">
                                        <div class="flex items-center gap-3 mb-2">
                                            <a href="{{ url_for('detalhes_vaga', vaga_id=vaga[0]) }}" class="block">
                                                <h3 class="text-xl font-bold text-gray-800 group-hover:text-purple-600 transition-colors">
                                                    {{ vaga[1] }}
                                                </h3>
                                            </a>
                                            <button onclick="toggleFavorite({{ vaga[0] }}, this)"
                                                    class="relative favorite-btn text-xl transition-all duration-300 hover:scale-125 {{ 'text-yellow-400' if vaga[6] else 'text-gray-300' }}"
                                                    data-favorited="{{ 'true' if vaga[6] else 'false' }}">
                                                {{ 'â­' if vaga[6] else 'â˜†' }}
                                                <span class="tooltiptext">
                                                    {% if vaga[6] %}Remover dos favoritos{% else %}Adicionar aos favoritos{% endif %}
                                                </span>
                                            </button>
                                        </div>
                                        <p class="text-purple-600 font-semibold mb-2 flex items-center gap-2">
                                            <span class="w-4 h-4 bg-purple-100 rounded-full flex items-center justify-center text-xs">ğŸ¢</span>
                                            {{ vaga[2] }}
                                        </p>
                                        <p class="text-lg font-bold text-green-600 mb-3 flex items-center gap-2">
                                            <span class="w-4 h-4 bg-green-100 rounded-full flex items-center justify-center text-xs">ğŸ’°</span>
                                            R$ {{ "%.2f"|format(vaga[3]) }}
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <div class="flex flex-col lg:flex-row items-start lg:items-center gap-4">
                                <div class="flex gap-3">
                                    <div class="text-center bg-gradient-to-r from-purple-500 to-blue-500 text-white px-6 py-4 rounded-2xl shadow-lg transform group-hover:scale-105 transition-all duration-300">
                                        <div class="text-2xl font-bold flex items-center gap-2">
                                            {% if vaga[5] == 1 %}
                                                <span class="text-yellow-300">ğŸ¥‡</span>
                                            {% elif vaga[5] == 2 %}
                                                <span class="text-gray-300">ğŸ¥ˆ</span>
                                            {% elif vaga[5] == 3 %}
                                                <span class="text-orange-300">ğŸ¥‰</span>
                                            {% else %}
                                                <span>ğŸƒ</span>
                                            {% endif %}
                                            {{ vaga[5] }}Âº
                                        </div>
                                        <div class="text-sm opacity-90 font-semibold">
                                            {% if vaga[5] <= 3 %}TOP 3{% else %}posiÃ§Ã£o{% endif %}
                                        </div>
                                    </div>
                                    <div class="text-center bg-gradient-to-r from-green-500 to-emerald-500 text-white px-6 py-4 rounded-2xl shadow-lg transform group-hover:scale-105 transition-all duration-300">
                                        <div class="text-2xl font-bold">{{ "%.0f"|format(vaga[4]) }}%</div>
                                        <div class="text-sm opacity-90 font-semibold">match</div>
                                    </div>
                                </div>

                                <button
                                    onclick="cancelarCandidatura({{ vaga[0] }})"
                                    class="group/btn bg-red-50 hover:bg-red-500 text-red-600 hover:text-white px-4 py-2 rounded-xl font-semibold transition-all duration-300 transform hover:scale-105 flex items-center gap-2">
                                    <span class="transition-transform group-hover/btn:rotate-90">âŒ</span>
                                    Cancelar
                                </button>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% else %}
            <div class="text-center py-12 bg-white rounded-2xl shadow-sm border border-gray-100">
                <div class="w-24 h-24 bg-gray-100 rounded-full mx-auto mb-6 flex items-center justify-center">
                    <span class="text-4xl">ğŸ“‹</span>
                </div>
                <h3 class="text-xl font-bold text-gray-600 mb-3">Nenhuma candidatura ainda</h3>
                <p class="text-gray-500 mb-6">Explore as vagas recomendadas e candidate-se!</p>
                <div class="w-20 h-1 bg-gradient-to-r from-purple-500 to-blue-500 mx-auto rounded-full"></div>
            </div>
            {% endif %}
        </div>

        <!-- SeÃ§Ã£o Favoritas -->
        <div id="section-favoritas" class="content-section hidden">
            {% if vagas_favoritas %}
            <div>
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold text-gray-800 flex items-center gap-3">
                        <span class="w-8 h-8 bg-yellow-100 rounded-lg flex items-center justify-center">â­</span>
                        Vagas Favoritas
                    </h2>
                    <span class="bg-yellow-100 text-yellow-700 px-3 py-1 rounded-full text-sm font-medium">
                        {{ vagas_favoritas|length }} favorita{{ 's' if vagas_favoritas|length != 1 else '' }}
                    </span>
                </div>

                <div class="grid gap-6">
                    {% for vaga in vagas_favoritas %}
                    <div class="group bg-white rounded-2xl p-6 shadow-sm border border-gray-100 hover:shadow-xl hover:border-yellow-200 transition-all duration-300 transform hover:-translate-y-1">
                        <div class="flex flex-col lg:flex-row gap-6">
                            <div class="flex-1">
                                <div class="flex items-start gap-4 mb-4">
                                    <div class="w-16 h-16 bg-gradient-to-br from-yellow-100 to-orange-100 rounded-xl flex items-center justify-center flex-shrink-0">
                                        <span class="text-2xl">â­</span>
                                    </div>
                                    <div class="flex-1">
                                        <div class="flex items-center gap-3 mb-2">
                                            <a href="{{ url_for('detalhes_vaga', vaga_id=vaga.id) }}" class="block">
                                                <h3 class="text-xl font-bold text-gray-800 group-hover:text-yellow-600 transition-colors">
                                                    {{ vaga.titulo }}
                                                </h3>
                                            </a>
                                            <button onclick="toggleFavorite({{ vaga.id }}, this)"
                                                    class="relative favorite-btn text-xl transition-all duration-300 hover:scale-125 text-yellow-400"
                                                    data-favorited="true">
                                                â­
                                                <span class="tooltiptext">Remover dos favoritos</span>
                                            </button>
                                        </div>
                                        <p class="text-purple-600 font-semibold mb-2 flex items-center gap-2">
                                            <span class="w-4 h-4 bg-purple-100 rounded-full flex items-center justify-center text-xs">ğŸ¢</span>
                                            {{ vaga.empresa_nome }}
                                        </p>
                                        <p class="text-lg font-bold text-green-600 mb-3 flex items-center gap-2">
                                            <span class="w-4 h-4 bg-green-100 rounded-full flex items-center justify-center text-xs">ğŸ’°</span>
                                            R$ {{ "%.2f"|format(vaga.salario) }}
                                        </p>

                                        {% if vaga.ja_candidatou %}
                                        <div class="bg-blue-50 p-3 rounded-lg mb-3">
                                            <p class="text-sm text-blue-700 font-medium flex items-center gap-2">
                                                <span>ğŸ¯</span> VocÃª jÃ¡ se candidatou a esta vaga
                                                {% if vaga.posicao %}
                                                <span class="ml-2 bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full">
                                                    {{ vaga.posicao }}Âº posiÃ§Ã£o
                                                </span>
                                                {% endif %}
                                            </p>
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>

                                <div class="bg-gray-50 p-4 rounded-xl">
                                    <p class="text-sm text-gray-600 leading-relaxed">{{ vaga.descricao[:200] }}{% if vaga.descricao|length > 200 %}...{% endif %}</p>
                                </div>
                            </div>

                            <div class="flex flex-col items-center justify-center lg:w-48 gap-4">
                                <div class="text-center bg-gradient-to-br from-yellow-400 to-orange-500 text-white p-4 rounded-xl shadow-lg">
                                    <div class="text-2xl font-bold mb-1">{{ "%.0f"|format(vaga.score) }}%</div>
                                    <p class="text-xs font-semibold opacity-90">MATCH</p>
                                </div>

                                {% if not vaga.ja_candidatou %}
                                <a href="{{ url_for('candidatar', vaga_id=vaga.id) }}"
                                   class="group/btn bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white font-bold px-6 py-3 rounded-xl shadow-lg transition-all duration-300 transform hover:scale-105 hover:shadow-xl flex items-center gap-2">
                                    <span class="transition-transform group-hover/btn:translate-x-1">ğŸš€</span>
                                    Candidatar-se
                                </a>
                                {% else %}
                                <div class="text-center">
                                    <div class="bg-green-100 text-green-800 px-4 py-2 rounded-xl font-semibold text-sm">
                                        âœ… Candidatado
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% else %}
            <div class="text-center py-12 bg-white rounded-2xl shadow-sm border border-gray-100">
                <div class="w-24 h-24 bg-yellow-100 rounded-full mx-auto mb-6 flex items-center justify-center">
                    <span class="text-4xl">â­</span>
                </div>
                <h3 class="text-xl font-bold text-gray-600 mb-3">Nenhuma vaga favorita ainda</h3>
                <p class="text-gray-500 mb-6">Favorite vagas interessantes para acompanhar mais facilmente!</p>
                <button onclick="showSection('principais')" class="bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white px-6 py-3 rounded-xl font-semibold transition-all duration-300 transform hover:scale-105">
                    ğŸ” Explorar Vagas
                </button>
            </div>
            {% endif %}
        </div>

        <!-- SeÃ§Ã£o Assistente IA -->
        <div id="section-assistente-ia" class="content-section hidden">
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent mb-3">
                    ğŸ¤– Assistente de IA
                </h2>
                <p class="text-gray-600">Obtenha insights personalizados sobre seu perfil e recomendaÃ§Ãµes inteligentes</p>
            </div>

            <!-- Cards do Assistente IA -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                <div class="bg-gradient-to-r from-purple-500 to-pink-500 rounded-2xl p-6 text-white shadow-lg hover:shadow-xl transition-all duration-300 transform hover:-translate-y-2">
                    <h3 class="text-xl font-semibold mb-4 flex items-center gap-2">
                        <span>ğŸ“Š</span> AnÃ¡lise do Perfil
                    </h3>
                    <p class="mb-4 opacity-90">Descubra seus pontos fortes e Ã¡reas de melhoria</p>
                    <button onclick="analisarCurriculo()" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg transition-colors w-full">
                        Analisar Agora
                    </button>
                </div>

                <div class="bg-gradient-to-r from-blue-500 to-cyan-500 rounded-2xl p-6 text-white shadow-lg hover:shadow-xl transition-all duration-300 transform hover:-translate-y-2">
                    <h3 class="text-xl font-semibold mb-4 flex items-center gap-2">
                        <span>ğŸ¯</span> Vagas Recomendadas IA
                    </h3>
                    <p class="mb-4 opacity-90">RecomendaÃ§Ãµes personalizadas baseadas no seu perfil</p>
                    <button onclick="obterRecomendacoesIA()" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg transition-colors w-full">
                        Ver RecomendaÃ§Ãµes
                    </button>
                </div>

                <div class="bg-gradient-to-r from-green-500 to-emerald-500 rounded-2xl p-6 text-white shadow-lg hover:shadow-xl transition-all duration-300 transform hover:-translate-y-2">
                    <h3 class="text-xl font-semibold mb-4 flex items-center gap-2">
                        <span>ğŸ’¡</span> Dicas para Favoritas
                    </h3>
                    <p class="mb-4 opacity-90">Receba dicas para melhorar suas chances nas vagas favoritas</p>
                    <button onclick="obterDicasFavoritas()" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg transition-colors w-full">
                        Obter Dicas
                    </button>
                </div>
            </div>

            <!-- Resultados da IA -->
            <div id="resultadosIA" class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100 hidden">
                <div id="conteudoIA"></div>
            </div>
        </div>
    </div>
</div>

<!-- Modal de NotificaÃ§Ãµes Melhorado -->
<div id="modalNotificacoes" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
    <div class="flex items-center justify-center min-h-screen p-4">
        <div class="bg-white rounded-3xl max-w-3xl w-full max-h-[85vh] flex flex-col shadow-2xl">
            <div class="flex justify-between items-center p-8 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-t-3xl">
                <div class="flex items-center gap-3">
                    <div class="w-12 h-12 bg-blue-100 rounded-2xl flex items-center justify-center">
                        <span class="text-2xl">ğŸ””</span>
                    </div>
                    <div>
                        <h3 class="text-2xl font-bold text-gray-800">Central de NotificaÃ§Ãµes</h3>
                        <p class="text-sm text-gray-600" id="contadorNotificacoes">Carregando...</p>
                    </div>
                </div>
                <button onclick="fecharModalNotificacoes()"
                        class="w-10 h-10 bg-red-100 hover:bg-red-200 text-red-600 rounded-xl transition-colors duration-200 flex items-center justify-center">
                    <span class="text-xl">âŒ</span>
                </button>
            </div>

            <div class="flex-1 overflow-y-auto p-6">
                <div id="listaNotificacoes" class="space-y-4">
                    <!-- NotificaÃ§Ãµes serÃ£o carregadas aqui via JavaScript -->
                </div>

                <div id="semNotificacoes" class="text-center py-16 text-gray-500 hidden">
                    <div class="w-24 h-24 bg-gray-100 rounded-full mx-auto mb-6 flex items-center justify-center">
                        <span class="text-4xl">ğŸ””</span>
                    </div>
                    <h4 class="text-xl font-semibold text-gray-600 mb-2">Nenhuma notificaÃ§Ã£o ainda</h4>
                    <p class="text-gray-500">Suas notificaÃ§Ãµes aparecerÃ£o aqui</p>
                </div>
            </div>

            <div class="p-6 border-t border-gray-200 bg-gray-50 rounded-b-3xl">
                <button onclick="marcarTodasComoLidas()"
                        class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-6 rounded-xl font-semibold transition-colors duration-200 flex items-center justify-center gap-2">
                    <span>âœ…</span> Marcar Todas como Lidas
                </button>
            </div>
        </div>
    </div>
</div>

<script>
// VariÃ¡veis globais
let notificacoesCache = [];
let categoriasBusca = [];
let localizacoesBusca = [];

// Gerenciamento de seÃ§Ãµes
function showSection(sectionName) {
    // Esconder todas as seÃ§Ãµes
    document.querySelectorAll('.content-section').forEach(section => {
        section.classList.add('hidden');
    });

    // Mostrar seÃ§Ã£o selecionada
    document.getElementById(`section-${sectionName}`).classList.remove('hidden');

    // Atualizar botÃµes
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.remove('filter-active');
        btn.classList.add('bg-gray-100', 'text-gray-700');
    });

    // Adiciona a classe ativa ao botÃ£o clicado
    const clickedButton = event.target.closest('.filter-btn');
    if (clickedButton) {
        clickedButton.classList.add('filter-active');
        clickedButton.classList.remove('bg-gray-100', 'text-gray-700');
    }


    // Carregar conteÃºdo especÃ­fico se necessÃ¡rio
    if (sectionName === 'todas') {
        loadAllJobs();
        loadSearchFilters();
    }
}

// Sistema de notificaÃ§Ãµes melhorado
  async function carregarNotificacoes() {
    try {
      const response = await fetch('/api/notificacoes');
      const data = await response.json();

      const lista = document.getElementById('listaNotificacoes');
      const semNotificacoes = document.getElementById('semNotificacoes');
      const contadorElement = document.getElementById('contadorNotificacoes');

      if (data.notificacoes && data.notificacoes.length > 0) {
        lista.innerHTML = '';
        semNotificacoes.classList.add('hidden');

        const naoLidas = data.notificacoes.filter(n => !n.lida).length;
        contadorElement.textContent = `${data.notificacoes.length} notificaÃ§Ã£o(Ãµes) â€¢ ${naoLidas} nÃ£o lida(s)`;

        data.notificacoes.forEach(notif => {
          const div = document.createElement('div');

          // Estilo baseado no tipo e status
          let classes = 'p-5 rounded-2xl border transition-all duration-300 shadow-sm hover:shadow-md';
          let borderColor = '';
          let bgColor = '';

          if (notif.is_fixada) {
            classes += ' ring-2 ring-yellow-300 ring-opacity-50';
            bgColor = 'bg-gradient-to-r from-yellow-50 to-orange-50';
            borderColor = 'border-yellow-300';
          } else if (!notif.lida) {
            bgColor = 'bg-gradient-to-r from-blue-50 to-indigo-50';
            borderColor = 'border-blue-200';
          } else {
            bgColor = 'bg-gray-50';
            borderColor = 'border-gray-200';
          }

          div.className = `${classes} ${bgColor} ${borderColor}`;

          const dataFormatada = new Date(notif.data_criacao).toLocaleDateString('pt-BR', {
            day: '2-digit',
            month: '2-digit',
            year: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
          });

          div.innerHTML = `
            <div class="flex items-start gap-4">
              <div class="w-12 h-12 rounded-2xl flex items-center justify-center flex-shrink-0 ${
                notif.is_fixada ? 'bg-yellow-200' :
                !notif.lida ? 'bg-blue-200' : 'bg-gray-200'
              }">
                <span class="text-2xl">${notif.emoji}</span>
              </div>
              <div class="flex-1 min-w-0">
                <div class="flex items-start justify-between mb-2">
                  <h4 class="font-bold ${
                    notif.is_fixada ? 'text-yellow-800' :
                    !notif.lida ? 'text-blue-800' : 'text-gray-700'
                  } text-lg leading-tight">
                    ${notif.is_fixada ? 'ğŸ“Œ ' : ''}${notif.titulo}
                  </h4>
                  ${!notif.lida && !notif.is_fixada ?
                    '<div class="w-3 h-3 bg-blue-500 rounded-full ml-3 flex-shrink-0 animate-pulse"></div>' : ''}
                </div>
                <p class="text-gray-700 mb-3 leading-relaxed">${notif.mensagem}</p>
                <div class="flex items-center gap-3 text-xs">
                  <span class="text-gray-500 bg-white px-2 py-1 rounded-full">${dataFormatada}</span>
                  ${notif.is_fixada ?
                    '<span class="bg-yellow-200 text-yellow-800 px-2 py-1 rounded-full font-semibold">ğŸ¯ Fixada</span>' : ''}
                  ${notif.tipo === 'contratacao' ?
                    '<span class="bg-green-200 text-green-800 px-2 py-1 rounded-full font-semibold">ğŸ† ContrataÃ§Ã£o</span>' : ''}
                </div>
              </div>
            </div>
          `;

          if (!notif.lida) {
            div.addEventListener('click', () => marcarComoLida(notif.id, div));
            div.classList.add('cursor-pointer', 'hover:scale-[1.02]');
          }

          lista.appendChild(div);
        });

        // Atualizar contador no botÃ£o
        atualizarContadorNotificacoes(naoLidas);

      } else {
        lista.innerHTML = '';
        semNotificacoes.classList.remove('hidden');
        contadorElement.textContent = 'Nenhuma notificaÃ§Ã£o';
        atualizarContadorNotificacoes(0);
      }
    } catch (error) {
      console.error('Erro ao carregar notificaÃ§Ãµes:', error);
      document.getElementById('contadorNotificacoes').textContent = 'Erro ao carregar';
    }
  }

function fecharModalNotificacoes() {
    document.getElementById('modalNotificacoes').classList.add('hidden');
}

function toggleNotificacoes() {
    const painel = document.getElementById('painelNotificacoes');
    painel.classList.toggle('hidden');
    if (!painel.classList.contains('hidden')) {
        carregarNotificacoes();
    }
}

async function marcarComoLida(notificacaoId, element) {
    try {
        const response = await fetch('/api/notificacoes/marcar-lida', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ id: notificacaoId })
        });
        if (response.ok) {
            carregarNotificacoes(); // Recarrega para atualizar a UI
        }
    } catch (error) {
        console.error('Erro ao marcar como lida:', error);
    }
}

// FunÃ§Ã£o para marcar todas as notificaÃ§Ãµes como lidas
async function marcarTodasComoLidas() {
    try {
      const response = await fetch('/api/marcar-todas-lidas', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        }
      });

      if (response.ok) {
        await carregarNotificacoes(); // Recarregar as notificaÃ§Ãµes
        showToast('âœ… Todas as notificaÃ§Ãµes foram marcadas como lidas!', 'success');
      } else {
        showToast('âŒ Erro ao marcar notificaÃ§Ãµes como lidas', 'error');
      }
    } catch (error) {
      console.error('Erro:', error);
      showToast('âŒ Erro de conexÃ£o', 'error');
    }
  }


async function apagarNotificacao(notificacaoId) {
    if (confirm('Tem certeza que deseja apagar esta notificaÃ§Ã£o?')) {
        try {
            const response = await fetch(`/api/notificacoes/${notificacaoId}/apagar`, { method: 'DELETE' });
            if (response.ok) {
                carregarNotificacoes();
            }
        } catch (error) {
            console.error('Erro ao apagar notificaÃ§Ã£o:', error);
        }
    }
}

async function apagarTodasNotificacoes() {
    if (confirm('Tem certeza que deseja apagar todas as notificaÃ§Ãµes?')) {
        try {
            const response = await fetch('/api/notificacoes/apagar-todas', { method: 'DELETE' });
            if (response.ok) {
                carregarNotificacoes();
            }
        } catch (error) {
            console.error('Erro ao apagar todas as notificaÃ§Ãµes:', error);
        }
    }
}

function verVaga(vagaId) {
    window.location.href = `/vaga/${vagaId}`;
}

// Carregar filtros para busca
async function loadSearchFilters() {
    try {
        const response = await fetch('/api/busca-filtros');
        const data = await response.json();

        categoriasBusca = data.categorias || [];
        localizacoesBusca = data.localizacoes || [];

        // Popular select de categorias
        const categorySelect = document.getElementById('searchCategory');
        categorySelect.innerHTML = '<option value="">Todas as categorias</option>';
        categoriasBusca.forEach(cat => {
            categorySelect.innerHTML += `<option value="${cat.id}">${cat.nome}</option>`;
        });

        // Popular select de localizaÃ§Ãµes
        const locationSelect = document.getElementById('searchLocation');
        locationSelect.innerHTML = '<option value="">Todas as localizaÃ§Ãµes</option>';
        localizacoesBusca.forEach(loc => {
            locationSelect.innerHTML += `<option value="${loc}">${loc}</option>`;
        });
    } catch (error) {
        console.error('Erro ao carregar filtros:', error);
    }
}

// Carregar todas as vagas
async function loadAllJobs() {
    const container = document.getElementById('todasVagasContainer');

    try {
        const response = await fetch('/api/todas-vagas');
        const vagas = await response.json();

        if (vagas.length === 0) {
            container.innerHTML = `
                <div class="text-center py-12 bg-white rounded-2xl shadow-sm border border-gray-100">
                    <div class="w-24 h-24 bg-gray-100 rounded-full mx-auto mb-6 flex items-center justify-center">
                        <span class="text-4xl">ğŸ”</span>
                    </div>
                    <h3 class="text-xl font-bold text-gray-600 mb-3">Nenhuma vaga disponÃ­vel</h3>
                    <p class="text-gray-500">No momento nÃ£o hÃ¡ vagas ativas no sistema.</p>
                </div>
            `;
            return;
        }

        renderVagas(vagas, container);
    } catch (error) {
        console.error('Erro ao carregar vagas:', error);
        container.innerHTML = `
            <div class="text-center py-12 bg-white rounded-2xl shadow-sm border border-gray-100">
                <div class="w-24 h-24 bg-red-100 rounded-full mx-auto mb-6 flex items-center justify-center">
                    <span class="text-4xl">âŒ</span>
                </div>
                <h3 class="text-xl font-bold text-gray-600 mb-3">Erro ao carregar vagas</h3>
                <p class="text-gray-500">Tente novamente mais tarde.</p>
            </div>
        `;
    }
}

// Realizar busca avanÃ§ada
async function realizarBusca() {
    const filtros = {
        keyword: document.getElementById('searchKeyword').value,
        location: document.getElementById('searchLocation').value,
        category: document.getElementById('searchCategory').value,
        urgency: document.getElementById('searchUrgency').value,
        salary: document.getElementById('searchSalary').value,
        type: document.getElementById('searchType').value
    };

    const container = document.getElementById('todasVagasContainer');
    container.innerHTML = `
        <div class="text-center py-8">
            <div class="animate-spin w-8 h-8 border-4 border-purple-500 border-t-transparent rounded-full mx-auto mb-4"></div>
            <p class="text-gray-500">Buscando vagas...</p>
        </div>
    `;

    try {
        const queryParams = new URLSearchParams();
        Object.keys(filtros).forEach(key => {
            if (filtros[key]) {
                queryParams.append(key, filtros[key]);
            }
        });

        const response = await fetch(`/api/buscar-vagas?${queryParams}`);
        const vagas = await response.json();

        if (vagas.length === 0) {
            container.innerHTML = `
                <div class="text-center py-12 bg-white rounded-2xl shadow-sm border border-gray-100">
                    <div class="w-24 h-24 bg-gray-100 rounded-full mx-auto mb-6 flex items-center justify-center">
                        <span class="text-4xl">ğŸ˜”</span>
                    </div>
                    <h3 class="text-xl font-bold text-gray-600 mb-3">Nenhuma vaga encontrada</h3>
                    <p class="text-gray-500">Tente ajustar os filtros de busca.</p>
                </div>
            `;
            return;
        }

        renderVagas(vagas, container, `${vagas.length} vaga(s) encontrada(s)`);
    } catch (error) {
        console.error('Erro na busca:', error);
        container.innerHTML = `
            <div class="text-center py-12 bg-white rounded-2xl shadow-sm border border-gray-100">
                <div class="w-24 h-24 bg-red-100 rounded-full mx-auto mb-6 flex items-center justify-center">
                    <span class="text-4xl">âŒ</span>
                </div>
                <h3 class="text-xl font-bold text-gray-600 mb-3">Erro na busca</h3>
                <p class="text-gray-500">Tente novamente mais tarde.</p>
            </div>
        `;
    }
}

// Renderizar vagas
function renderVagas(vagas, container, titulo = null) {
    let html = '';

    if (titulo) {
        html += `
            <div class="mb-6">
                <h3 class="text-xl font-bold text-gray-800 mb-2">Resultados</h3>
                <p class="text-gray-600">${titulo}</p>
            </div>
        `;
    }

    html += '<div class="grid gap-6">';

    vagas.forEach(vaga => {
        html += `
            <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100 hover:shadow-xl hover:border-purple-200 transition-all duration-300 transform hover:-translate-y-1 group">
                <div class="flex flex-col lg:flex-row lg:items-start justify-between gap-4">
                    <div class="flex-1">
                        <div class="flex items-center gap-3 mb-3">
                            <h3 class="text-xl font-bold text-gray-800 group-hover:text-purple-600 transition-colors">
                                ${vaga.titulo}
                            </h3>
                            ${vaga.is_favorita ? '<span class="bg-red-100 text-red-800 px-2 py-1 rounded-full text-xs font-medium">â­ Favorita</span>' : ''}
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm text-gray-600 mb-4">
                            <div class="flex items-center gap-2">
                                <span>ğŸ¢</span>
                                <span>${vaga.empresa_nome}</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <span>ğŸ’°</span>
                                <span class="font-semibold text-green-600">R$ ${vaga.salario_oferecido.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <span>ğŸ </span>
                                <span>${vaga.tipo_vaga || 'Presencial'}</span>
                            </div>
                            ${vaga.endereco_vaga ? `
                            <div class="flex items-center gap-2">
                                <span>ğŸ“</span>
                                <span>${vaga.endereco_vaga}</span>
                            </div>` : ''}
                        </div>

                        <p class="text-gray-600 line-clamp-2 mb-3">${vaga.descricao}</p>

                    </div>

                    <div class="flex flex-col items-center gap-3 lg:w-32">
                        <div class="text-center bg-gradient-to-r from-purple-500 to-blue-500 text-white px-4 py-3 rounded-xl shadow-md">
                            <div class="text-lg font-bold">${vaga.score.toFixed(0)}</div>
                            <div class="text-xs opacity-90">match</div>
                        </div>

                        <div class="flex gap-2">
                            <button onclick="toggleFavorite(${vaga.id}, this)"
                                    data-favorited="${vaga.is_favorita}"
                                    class="relative favorite-btn text-xl transition-all duration-300 hover:scale-125 ${vaga.is_favorita ? 'text-red-500' : 'text-gray-300'}">
                                ${vaga.is_favorita ? 'â­' : 'â˜†'}
                                <span class="tooltiptext">
                                    ${vaga.is_favorita ? 'Remover dos favoritos' : 'Adicionar aos favoritos'}
                                </span>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="flex gap-3 pt-4 border-t border-gray-100">
                    <a href="/vaga/${vaga.id}"
                       class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-xl font-semibold transition-all duration-300 transform hover:scale-105 flex items-center gap-2">
                        <span>ğŸ‘ï¸</span>
                        Ver Detalhes
                    </a>

                    ${!vaga.ja_candidatou ?
                        `<a href="/candidatar/${vaga.id}" class="group/btn bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white font-bold px-6 py-3 rounded-xl shadow-lg transition-all duration-300 transform hover:scale-105 hover:shadow-xl flex items-center gap-2">
                            <span class="transition-transform group-hover/btn:translate-x-1">ğŸš€</span>
                            Candidatar-se
                        </a>` :
                        '<span class="bg-gray-100 text-gray-600 px-4 py-2 rounded-xl text-sm">âœ… JÃ¡ candidatado</span>'
                    }
                </div>
            </div>
        `;
    });

    html += '</div>';
    container.innerHTML = html;
}

// Limpar filtros de busca
function limparFiltros() {
    document.getElementById('searchKeyword').value = '';
    document.getElementById('searchLocation').value = '';
    document.getElementById('searchCategory').value = '';
    document.getElementById('searchUrgency').value = '';
    document.getElementById('searchSalary').value = '';
    document.getElementById('searchType').value = '';
    loadAllJobs();
}

// Sistema de favoritos
async function toggleFavorite(vagaId, button) {
    const isFavorited = button.dataset.favorited === 'true';

    try {
        button.classList.add('animate-pulse');

        const response = await fetch('/api/favoritar-vaga', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                vaga_id: vagaId,
                acao: 'toggle'
            })
        });

        const result = await response.json();

        if (result.success) {
            button.dataset.favorited = result.favorited;
            button.innerHTML = result.favorited ? 'â­' : 'â˜†';
            button.className = `relative favorite-btn text-xl transition-all duration-300 hover:scale-125 ${result.favorited ? 'text-red-500' : 'text-gray-300'}`;

            // Atualiza o texto do tooltip
            const tooltip = button.querySelector('.tooltiptext');
            if (tooltip) {
                tooltip.textContent = result.favorited ? 'Remover dos favoritos' : 'Adicionar aos favoritos';
            }

            showToast(result.message, 'success');
        } else {
            showToast(result.message || 'Erro ao favoritar vaga', 'error');
        }
    } catch (error) {
        console.error('Erro ao favoritar:', error);
        showToast('Erro ao favoritar vaga', 'error');
    } finally {
        button.classList.remove('animate-pulse');
    }
}

// Cancelar candidatura
async function cancelarCandidatura(vagaId) {
    if (confirm('ğŸ¤” Tem certeza que deseja cancelar sua candidatura para esta vaga?')) {
        try {
            const btn = event.target.closest('button');
            const originalContent = btn.innerHTML;
            btn.innerHTML = '<span class="animate-spin">â³</span> Cancelando...';
            btn.disabled = true;

            const response = await fetch('/cancelar_candidatura', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    vaga_id: vagaId
                })
            });

            if (response.ok) {
                btn.innerHTML = '<span class="text-green-500">âœ…</span> Cancelada!';
                setTimeout(() => {
                    location.reload();
                }, 1000);
            } else {
                btn.innerHTML = originalContent;
                btn.disabled = false;
                alert('âŒ Erro ao cancelar candidatura');
            }
        } catch (error) {
            console.error('Erro:', error);
            alert('âŒ Erro ao cancelar candidatura');
        }
    }
}

// FunÃ§Ãµes do Assistente IA
async function analisarCurriculo() {
    const resultadosDiv = document.getElementById('resultadosIA');
    const conteudoDiv = document.getElementById('conteudoIA');

    resultadosDiv.classList.remove('hidden');
    conteudoDiv.innerHTML = `
        <div class="text-center py-8">
            <div class="animate-spin w-8 h-8 border-4 border-purple-500 border-t-transparent rounded-full mx-auto mb-4"></div>
            <p class="text-gray-500">Analisando seu currÃ­culo...</p>
        </div>
    `;

    try {
        const response = await fetch('/api/ia/analisar-curriculo');
        const data = await response.json();

        if (data.error) {
            conteudoDiv.innerHTML = `
                <div class="text-center py-8 text-red-500">
                    <p>Erro: ${data.error}</p>
                </div>
            `;
        } else {
            mostrarAnaliseIA(data);
        }
    } catch (error) {
        conteudoDiv.innerHTML = `
            <div class="text-center py-8 text-red-500">
                <p>Erro ao carregar anÃ¡lise</p>
            </div>
        `;
    }
}

function mostrarAnaliseIA(analise) {
    const conteudoDiv = document.getElementById('conteudoIA');

    const tecnologias = analise.tecnologias_identificadas?.map(t => t.nome)?.join(', ') || 'Nenhuma identificada';
    const pontosFortes = analise.pontos_fortes?.map(p => `<li class="text-green-600">âœ… ${p}</li>`)?.join('') || '<li class="text-gray-500">Analisando...</li>';
    const areasMelhoria = analise.areas_melhoria?.map(a => `<li class="text-orange-600">âš ï¸ ${a}</li>`)?.join('') || '<li class="text-gray-500">Nenhuma identificada</li>';

    conteudoDiv.innerHTML = `
        <h3 class="text-xl font-bold mb-6 text-gray-800">ğŸ“Š AnÃ¡lise do seu Perfil</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
                <h4 class="font-semibold mb-3 text-purple-600">ğŸ“Š AnÃ¡lise Geral</h4>
                <div class="space-y-2">
                    <p><strong>NÃ­vel:</strong> <span class="badge bg-blue-100 text-blue-800 px-2 py-1 rounded">${analise.nivel_senioridade || 'Analisando...'}</span></p>
                    <p><strong>Score do Perfil:</strong> <span class="text-2xl font-bold text-green-600">${analise.score_geral || 0}/100</span></p>
                    <p><strong>Tecnologias:</strong> ${tecnologias}</p>
                </div>
            </div>
            <div>
                <h4 class="font-semibold mb-3 text-green-600">âœ¨ Pontos Fortes</h4>
                <ul class="space-y-1">
                    ${pontosFortes}
                </ul>
            </div>
            <div class="md:col-span-2">
                <h4 class="font-semibold mb-3 text-orange-600">ğŸ¯ Ãreas de Melhoria</h4>
                <ul class="space-y-1">
                    ${areasMelhoria}
                </ul>
            </div>
        </div>
    `;
}

async function obterRecomendacoesIA() {
    const resultadosDiv = document.getElementById('resultadosIA');
    const conteudoDiv = document.getElementById('conteudoIA');

    resultadosDiv.classList.remove('hidden');
    conteudoDiv.innerHTML = `
        <div class="text-center py-8">
            <div class="animate-spin w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-4"></div>
            <p class="text-gray-500">Obtendo recomendaÃ§Ãµes personalizadas...</p>
        </div>
    `;

    try {
        const response = await fetch('/api/ia/recomendacoes-vagas');
        const data = await response.json();

        if (data.length === 0) {
            conteudoDiv.innerHTML = `
                <div class="text-center py-8">
                    <p class="text-gray-500">Nenhuma recomendaÃ§Ã£o disponÃ­vel no momento</p>
                </div>
            `;
        } else {
            mostrarRecomendacoesIA(data);
        }
    } catch (error) {
        conteudoDiv.innerHTML = `
            <div class="text-center py-8 text-red-500">
                <p>Erro ao obter recomendaÃ§Ãµes</p>
            </div>
        `;
    }
}

function mostrarRecomendacoesIA(recomendacoes) {
    const conteudoDiv = document.getElementById('conteudoIA');

    const recomendacoesHtml = recomendacoes.map(rec => `
        <div class="bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
            <div class="flex justify-between items-start mb-2">
                <h3 class="font-semibold text-lg">${rec.titulo}</h3>
                <span class="text-sm text-purple-600 font-bold">${rec.compatibilidade?.score?.toFixed(0) || 0}% compatÃ­vel</span>
            </div>
            <p class="text-gray-600 mb-2">${rec.empresa}</p>
            <div class="text-sm text-gray-500">
                <p><strong>Motivos:</strong> ${rec.motivos?.join(', ') || 'N/A'}</p>
                ${rec.urgencia === 'Imediata' ? '<span class="bg-red-100 text-red-800 px-2 py-1 rounded text-xs">ğŸ”¥ URGENTE</span>' : ''}
            </div>
            <a href="/candidatar/${rec.vaga_id}" class="mt-3 bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700 transition-colors inline-block">
                Candidatar-se
            </a>
        </div>
    `).join('');

    conteudoDiv.innerHTML = `
        <h3 class="text-xl font-bold mb-6 text-gray-800">ğŸ¯ Vagas Recomendadas pela IA</h3>
        <div class="space-y-4 max-h-64 overflow-y-auto">
            ${recomendacoesHtml}
        </div>
    `;
}

async function obterDicasFavoritas() {
    const resultadosDiv = document.getElementById('resultadosIA');
    const conteudoDiv = document.getElementById('conteudoIA');

    resultadosDiv.classList.remove('hidden');
    conteudoDiv.innerHTML = `
        <div class="text-center py-8">
            <div class="animate-spin w-8 h-8 border-4 border-green-500 border-t-transparent rounded-full mx-auto mb-4"></div>
            <p class="text-gray-500">Analisando suas vagas favoritas...</p>
        </div>
    `;

    // Simular anÃ¡lise das vagas favoritas
    setTimeout(() => {
        conteudoDiv.innerHTML = `
            <h3 class="text-xl font-bold mb-6 text-gray-800">ğŸ’¡ Dicas para suas Vagas Favoritas</h3>
            <div class="space-y-4">
                <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                    <h4 class="font-semibold text-green-800 mb-2">âœ… Pontos Fortes do seu Perfil</h4>
                    <ul class="text-sm text-green-700 space-y-1">
                        <li>â€¢ ExperiÃªncia sÃ³lida na Ã¡rea</li>
                        <li>â€¢ CompetÃªncias tÃ©cnicas alinhadas</li>
                        <li>â€¢ FormaÃ§Ã£o adequada para as posiÃ§Ãµes</li>
                    </ul>
                </div>

                <div class="bg-orange-50 border border-orange-200 rounded-lg p-4">
                    <h4 class="font-semibold text-orange-800 mb-2">ğŸ¯ Ãreas para Melhorar</h4>
                    <ul class="text-sm text-orange-700 space-y-1">
                        <li>â€¢ Adicione mais projetos prÃ¡ticos ao seu currÃ­culo</li>
                        <li>â€¢ Destaque certificaÃ§Ãµes relevantes</li>
                        <li>â€¢ Inclua mÃ©tricas de resultados alcanÃ§ados</li>
                    </ul>
                </div>

                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <h4 class="font-semibold text-blue-800 mb-2">ğŸ’¡ RecomendaÃ§Ãµes EspecÃ­ficas</h4>
                    <ul class="text-sm text-blue-700 space-y-1">
                        <li>â€¢ Personalize sua carta de apresentaÃ§Ã£o</li>
                        <li>â€¢ Atualize seu perfil no LinkedIn</li>
                        <li>â€¢ Pratique entrevistas tÃ©cnicas</li>
                    </ul>
                </div>
            </div>
        `;
    }, 2000);
}

// Toast notifications
function showToast(message, type = 'info') {
    const toast = document.createElement('div');
    toast.className = `fixed bottom-4 right-4 z-50 px-6 py-4 rounded-xl shadow-lg transform translate-y-full transition-all duration-300 ${
        type === 'success' ? 'bg-green-500 text-white' :
        type === 'error' ? 'bg-red-500 text-white' :
        'bg-blue-500 text-white'
    }`;
    toast.textContent = message;

    document.body.appendChild(toast);

    setTimeout(() => {
        toast.classList.remove('translate-y-full');
    }, 100);

    setTimeout(() => {
        toast.classList.add('translate-y-full');
        setTimeout(() => {
            document.body.removeChild(toast);
        }, 300);
    }, 3000);
}

// Fechar painel ao clicar fora
document.addEventListener('click', function(e) {
    const painel = document.getElementById('painelNotificacoes');
    const btn = document.getElementById('btnNotificacoes');

    // Verifica se o clique ocorreu fora do painel e do botÃ£o que o abre
    if (painel && btn && !painel.contains(e.target) && !btn.contains(e.target)) {
        painel.classList.add('hidden');
    }
});

// InicializaÃ§Ã£o
document.addEventListener('DOMContentLoaded', function() {
    carregarNotificacoes();

    // Atualizar notificaÃ§Ãµes periodicamente
    setInterval(carregarNotificacoes, 30000);

    // Animar cards ao aparecer na tela
    const cards = document.querySelectorAll('.group');
    const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry, index) => {
            if (entry.isIntersecting) {
                setTimeout(() => {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                }, index * 100);
            }
        });
    }, { threshold: 0.1 }); // Ajuste o threshold conforme necessÃ¡rio

    cards.forEach(card => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        card.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
        observer.observe(card);
    });
});

// Toggle para a Busca AvanÃ§ada na seÃ§Ã£o Principais
function toggleAdvancedSearch() {
    const panel = document.getElementById('advancedSearchPanel');
    panel.classList.toggle('hidden');
    const searchIcon = document.getElementById('searchIcon');
    searchIcon.classList.toggle('rotate-12');
}

// Toggle para a Busca AvanÃ§ada na seÃ§Ã£o Todas
function toggleAdvancedSearchTodas() {
    const panel = document.getElementById('advancedSearchPanelTodas');
    panel.classList.toggle('hidden');
    const searchIcon = document.getElementById('searchIconTodas');
    searchIcon.classList.toggle('rotate-12');
}

// FunÃ§Ãµes de busca para a seÃ§Ã£o Principais
async function realizarBuscaPrincipal() {
    const filtros = {
        keyword: document.getElementById('searchKeywordPrinc').value,
        location: document.getElementById('searchLocationPrinc').value,
        category: document.getElementById('searchCategoryPrinc').value,
        urgency: document.getElementById('searchUrgencyPrinc').value,
        salary: document.getElementById('searchSalaryPrinc').value,
        type: document.getElementById('searchTypePrinc').value
    };


    const container = document.getElementById('principaisVagasContainer');
    container.innerHTML = `
        <div class="text-center py-8">
            <div class="animate-spin w-8 h-8 border-4 border-purple-500 border-t-transparent rounded-full mx-auto mb-4"></div>
            <p class="text-gray-500">Buscando vagas recomendadas...</p>
        </div>
    `;

    try {
        const queryParams = new URLSearchParams();
        Object.keys(filtros).forEach(key => {
            if (filtros[key]) {
                queryParams.append(key, filtros[key]);
            }
        });

        const response = await fetch(`/api/buscar-vagas-recomendadas?${queryParams}`);
        const vagas = await response.json();

        if (vagas.length === 0) {
            container.innerHTML = `
                <div class="text-center py-12 bg-white rounded-3xl shadow-lg border border-gray-100">
                    <div class="w-32 h-32 bg-gray-100 rounded-full mx-auto mb-8 flex items-center justify-center">
                        <span class="text-6xl">ğŸ˜”</span>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-600 mb-4">Nenhuma vaga encontrada com esses filtros</h3>
                    <p class="text-gray-500 mb-8 max-w-md mx-auto">Tente ajustar os filtros ou explorar outras seÃ§Ãµes.</p>
                </div>
            `;
            return;
        }

        renderVagasRecomendadas(vagas, container);
    } catch (error) {
        console.error('Erro na busca principal:', error);
        container.innerHTML = `
            <div class="text-center py-12 bg-white rounded-3xl shadow-lg border border-gray-100">
                <div class="w-32 h-32 bg-red-100 rounded-full mx-auto mb-8 flex items-center justify-center">
                    <span class="text-6xl">âŒ</span>
                </div>
                <h3 class="text-2xl font-bold text-gray-600 mb-4">Erro ao buscar vagas</h3>
                <p class="text-gray-500 max-w-md mx-auto">Tente novamente mais tarde.</p>
            </div>
        `;
    }
}

function limparFiltrosPrincipal() {
    document.getElementById('searchKeywordPrinc').value = '';
    document.getElementById('searchLocationPrinc').value = '';
    document.getElementById('searchCategoryPrinc').value = '';
    document.getElementById('searchUrgencyPrinc').value = '';
    document.getElementById('searchSalaryPrinc').value = '';
    document.getElementById('searchTypePrinc').value = '';
    // NÃ£o recarrega todas as vagas, apenas limpa os campos. A busca Ã© feita ao clicar em "Buscar Vagas".
}

// Renderizar vagas recomendadas (similar a renderVagas, mas com a estrutura da seÃ§Ã£o Principais)
function renderVagasRecomendadas(vagas, container) {
    let html = `
        <div class="text-center mb-8">
            <h2 class="text-3xl font-bold bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent mb-3">
                Vagas Recomendadas Para VocÃª
            </h2>
            <p class="text-gray-600 bg-white px-6 py-3 rounded-full inline-block shadow-sm border border-gray-100">
                â­ Top ${vagas.length} vagas compatÃ­veis com seu perfil
            </p>
        </div>
        <div class="grid gap-6">
    `;

    vagas.forEach(vaga => {
        html += `
            <div class="group bg-white rounded-3xl p-8 shadow-lg border border-gray-100 hover:shadow-2xl hover:border-purple-200 transition-all duration-500 transform hover:-translate-y-1 overflow-hidden relative">
                <div class="absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-purple-500 via-blue-500 to-emerald-500"></div>
                <div class="flex flex-col lg:flex-row gap-8">
                    <div class="flex-1">
                        <div class="flex items-start gap-6 mb-6">
                            <div class="relative">
                                <div class="w-20 h-20 bg-gradient-to-br from-purple-100 to-blue-100 rounded-2xl flex items-center justify-center flex-shrink-0 group-hover:scale-110 transition-all duration-300">
                                    <span class="text-3xl">ğŸ’¼</span>
                                </div>
                                <div class="absolute -top-2 -right-2 w-6 h-6 bg-gradient-to-r from-green-400 to-emerald-500 rounded-full flex items-center justify-center">
                                    <span class="text-xs font-bold text-white">${vaga.score.toFixed(0)}%</span>
                                </div>
                            </div>
                            <div class="flex-1">
                                <div class="flex items-center gap-3 mb-3">
                                    <a href="/vaga/${vaga.id}" class="block">
                                        <h3 class="text-2xl font-bold text-gray-800 group-hover:text-purple-600 transition-colors">${vaga.titulo}</h3>
                                    </a>
                                    <button onclick="toggleFavorite(${vaga.id}, this)"
                                            class="relative favorite-btn text-2xl transition-all duration-300 hover:scale-125 ${vaga.is_favorita ? 'text-yellow-400' : 'text-gray-300'}"
                                            data-favorited="${vaga.is_favorita}">
                                        ${vaga.is_favorita ? 'â­' : 'â˜†'}
                                        <span class="tooltiptext">
                                            ${vaga.is_favorita ? 'Remover dos favoritos' : 'Adicionar aos favoritos'}
                                        </span>
                                    </button>
                                </div>
                                <div class="flex flex-wrap gap-3 mb-4">
                                    <span class="inline-flex items-center gap-2 bg-purple-100 text-purple-700 px-3 py-1 rounded-full text-sm font-semibold">
                                        ğŸ¢ ${vaga.empresa_nome}
                                    </span>
                                    <span class="inline-flex items-center gap-2 bg-green-100 text-green-700 px-3 py-1 rounded-full text-sm font-bold">
                                        ğŸ’° R$ ${vaga.salario_oferecido.toLocaleString('pt-BR', {minimumFractionDigits: 2})}
                                    </span>
                                    ${vaga.tipo_vaga ? `
                                    <span class="inline-flex items-center gap-2 bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-sm font-medium">
                                        ğŸŒ ${vaga.tipo_vaga}
                                    </span>` : ''}
                                </div>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                            <div class="bg-gradient-to-r from-gray-50 to-blue-50 p-4 rounded-2xl border border-gray-100">
                                <p class="text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2">
                                    <span class="w-6 h-6 bg-blue-500 rounded-lg flex items-center justify-center text-white text-xs">ğŸ“</span>
                                    DescriÃ§Ã£o
                                </p>
                                <p class="text-sm text-gray-600 leading-relaxed">${vaga.descricao.substring(0, 150)}${vaga.descricao.length > 150 ? '...' : ''}</p>
                            </div>
                            <div class="bg-gradient-to-r from-purple-50 to-pink-50 p-4 rounded-2xl border border-purple-100">
                                <p class="text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2">
                                    <span class="w-6 h-6 bg-purple-500 rounded-lg flex items-center justify-center text-white text-xs">âš¡</span>
                                    Requisitos
                                </p>
                                <p class="text-sm text-gray-600 leading-relaxed">${vaga.requisitos.substring(0, 150)}${vaga.requisitos.length > 150 ? '...' : ''}</p>
                            </div>
                        </div>
                    </div>
                    <div class="flex flex-col items-center justify-center lg:w-56 gap-6">
                        <div class="text-center bg-gradient-to-br from-green-400 via-emerald-500 to-teal-500 text-white p-6 rounded-3xl shadow-xl transform group-hover:scale-105 transition-all duration-300">
                            <div class="text-3xl font-bold mb-2">${vaga.score.toFixed(0)}%</div>
                            <p class="text-sm font-semibold opacity-90">MATCH</p>
                            <div class="w-full bg-white bg-opacity-30 rounded-full h-2 mt-3">
                                <div class="bg-white h-2 rounded-full transition-all duration-1000" style="width: ${vaga.score}%"></div>
                            </div>
                        </div>
                        <div class="flex flex-col gap-3 w-full">
                            <a href="/candidatar/${vaga.id}"
                               class="group/btn bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white font-bold px-6 py-4 rounded-2xl shadow-lg transition-all duration-300 transform hover:scale-105 hover:shadow-xl flex items-center justify-center gap-3">
                                <span class="transition-transform group-hover/btn:rotate-12">ğŸš€</span>
                                Candidatar-se
                            </a>
                            <a href="/vaga/${vaga.id}"
                               class="bg-white hover:bg-gray-50 text-gray-700 border border-gray-200 font-semibold px-6 py-3 rounded-2xl transition-all duration-300 transform hover:scale-105 flex items-center justify-center gap-2">
                                <span>ğŸ‘ï¸</span>
                                Ver Detalhes
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        `;
    });

    html += '</div>';
    container.innerHTML = html;
}

// Carregar filtros para busca na seÃ§Ã£o Principais
async function loadSearchFiltersPrincipais() {
    try {
        const response = await fetch('/api/busca-filtros');
        const data = await response.json();

        // Popular select de categorias
        const categorySelect = document.getElementById('searchCategoryPrinc');
        categorySelect.innerHTML = '<option value="">Todas as categorias</option>';
        data.categorias.forEach(cat => {
            categorySelect.innerHTML += `<option value="${cat.id}">${cat.nome}</option>`;
        });

        // Popular select de localizaÃ§Ãµes
        const locationSelect = document.getElementById('searchLocationPrinc');
        locationSelect.innerHTML = '<option value="">Todas as localizaÃ§Ãµes</option>';
        data.localizacoes.forEach(loc => {
            locationSelect.innerHTML += `<option value="${loc}">${loc}</option>`;
        });
    } catch (error) {
        console.error('Erro ao carregar filtros:', error);
    }
}

// Atualizar contador de notificaÃ§Ãµes no badge
function atualizarContadorNotificacoes(naoLidas) {
    const badge = document.getElementById('badgeNotificacoes');
    const dot = document.getElementById('notificationDot');
    if (naoLidas > 0) {
        badge.textContent = naoLidas;
        badge.classList.remove('hidden');
        dot.classList.remove('hidden');
    } else {
        badge.classList.add('hidden');
        dot.classList.add('hidden');
    }
}

// Inicializa a seÃ§Ã£o de Principais com os filtros de busca
document.addEventListener('DOMContentLoaded', function() {
    loadSearchFiltersPrincipais();
});

</script>
{% endblock %}