{% extends "base.html" %}

{% block title %}Editar Vaga{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-purple-50 to-blue-50 py-8">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="bg-white rounded-2xl shadow-lg p-8">
            <div class="mb-8">
                <h1 class="text-3xl font-bold text-gray-900 mb-2">Editar Vaga</h1>
                <p class="text-gray-600">Atualize as informa√ß√µes da vaga</p>
            </div>

            <form method="POST" class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="md:col-span-2">
                        <label for="titulo" class="block text-sm font-medium text-gray-700 mb-2">
                            T√≠tulo da Vaga *
                        </label>
                        <input type="text" id="titulo" name="titulo" required value="{{ vaga.titulo }}"
                               class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200">
                    </div>

                    <div>
                        <label for="salario_oferecido" class="block text-sm font-medium text-gray-700 mb-2">
                            Sal√°rio Oferecido (R$) *
                        </label>
                        <input type="number" id="salario_oferecido" name="salario_oferecido" required step="0.01" min="0" value="{{ vaga.salario_oferecido }}"
                               class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200">
                    </div>

                    <div>
                        <label for="tipo_vaga" class="block text-sm font-medium text-gray-700 mb-2">
                            Tipo da Vaga *
                        </label>
                        <select id="tipo_vaga" name="tipo_vaga" required
                                class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200"
                                onchange="toggleEnderecoField()">
                            <option value="Presencial" {{ 'selected' if vaga.tipo_vaga == 'Presencial' else '' }}>üè¢ Presencial</option>
                            <option value="Remoto" {{ 'selected' if vaga.tipo_vaga == 'Remoto' else '' }}>üè† Remoto</option>
                            <option value="H√≠brida" {{ 'selected' if vaga.tipo_vaga == 'H√≠brida' else '' }}>üîÑ H√≠brida</option>
                        </select>
                    </div>

                    <div>
                        <label for="categoria_id" class="block text-sm font-medium text-gray-700 mb-2">
                            Categoria da Vaga
                        </label>
                        <select id="categoria_id" name="categoria_id"
                                class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200"
                                onchange="toggleNovaCategoria()">
                            <option value="">Selecione uma categoria</option>
                            {% for categoria in categorias %}
                            <option value="{{ categoria.id }}" {{ 'selected' if categoria.id == vaga.categoria_id else '' }}>{{ categoria.nome }}</option>
                            {% endfor %}
                            <option value="nova">+ Adicionar nova categoria</option>
                        </select>
                    </div>

                    <div id="nova_categoria_container" class="hidden">
                        <label for="nova_categoria" class="block text-sm font-medium text-gray-700 mb-2">
                            Nova Categoria
                        </label>
                        <input type="text" id="nova_categoria" name="nova_categoria"
                               class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200"
                               placeholder="Ex: Marketing Digital">
                    </div>

                    <div>
                        <label for="urgencia_contratacao" class="block text-sm font-medium text-gray-700 mb-2">
                            Urg√™ncia da Contrata√ß√£o
                        </label>
                        <select id="urgencia_contratacao" name="urgencia_contratacao"
                                class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200">
                            <option value="">Selecione a urg√™ncia</option>
                            <option value="Imediata" {{ 'selected' if vaga.urgencia_contratacao == 'Imediata' else '' }}>üö® Imediata</option>
                            <option value="Em at√© 30 dias" {{ 'selected' if vaga.urgencia_contratacao == 'Em at√© 30 dias' else '' }}>‚è∞ Em at√© 30 dias</option>
                            <option value="Em at√© 60 dias" {{ 'selected' if vaga.urgencia_contratacao == 'Em at√© 60 dias' else '' }}>üìÖ Em at√© 60 dias</option>
                            <option value="Sem urg√™ncia" {{ 'selected' if vaga.urgencia_contratacao == 'Sem urg√™ncia' else '' }}>üïê Sem urg√™ncia</option>
                        </select>
                    </div>

                    <div>
                        <label for="data_congelamento_agendado" class="block text-sm font-medium text-gray-700 mb-2">
                            Congelamento Agendado
                        </label>
                        <input type="date" id="data_congelamento_agendado" name="data_congelamento_agendado"
                               value="{{ vaga.data_congelamento_agendado if vaga.data_congelamento_agendado else '' }}"
                               class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200"
                               min="{{ (datetime.now() + timedelta(days=1)).strftime('%Y-%m-%d') }}">
                        <p class="text-xs text-gray-500 mt-1">
                            Opcional: A vaga ser√° automaticamente congelada nesta data
                        </p>
                    </div>

                    <div id="endereco_container" class="md:col-span-2 {{ 'hidden' if vaga.tipo_vaga == 'Remoto' else '' }}">
                        <div class="mb-4">
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" id="usar_endereco_empresa" name="usar_endereco_empresa" 
                                       {{ 'checked' if vaga.usar_endereco_empresa else '' }}
                                       class="rounded border-gray-300 text-purple-600 focus:ring-purple-500"
                                       onchange="toggleEnderecoEmpresa()">
                                <span class="text-sm text-gray-700">Usar endere√ßo da empresa</span>
                            </label>
                        </div>

                        <div id="campos_endereco_vaga">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="md:col-span-2">
                                    <label for="localizacao_endereco" class="block text-sm font-medium text-gray-700 mb-2">
                                        Endere√ßo *
                                    </label>
                                    <input type="text" id="localizacao_endereco" name="localizacao_endereco"
                                           value="{{ vaga.localizacao_endereco if vaga.localizacao_endereco else '' }}"
                                           class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200"
                                           placeholder="Ex: Rua das Flores, 123">
                                </div>

                                <div>
                                    <label for="localizacao_cidade" class="block text-sm font-medium text-gray-700 mb-2">
                                        Cidade *
                                    </label>
                                    <input type="text" id="localizacao_cidade" name="localizacao_cidade"
                                           value="{{ vaga.localizacao_cidade if vaga.localizacao_cidade else '' }}"
                                           class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200"
                                           placeholder="Ex: S√£o Paulo">
                                </div>

                                <div>
                                    <label for="localizacao_estado" class="block text-sm font-medium text-gray-700 mb-2">
                                        Estado *
                                    </label>
                                    <select id="localizacao_estado" name="localizacao_estado"
                                            class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200">
                                        <option value="">Selecione o estado</option>
                                        {% set estados = [
                                            ('AC', 'Acre'), ('AL', 'Alagoas'), ('AP', 'Amap√°'), ('AM', 'Amazonas'),
                                            ('BA', 'Bahia'), ('CE', 'Cear√°'), ('DF', 'Distrito Federal'), ('ES', 'Esp√≠rito Santo'),
                                            ('GO', 'Goi√°s'), ('MA', 'Maranh√£o'), ('MT', 'Mato Grosso'), ('MS', 'Mato Grosso do Sul'),
                                            ('MG', 'Minas Gerais'), ('PA', 'Par√°'), ('PB', 'Para√≠ba'), ('PR', 'Paran√°'),
                                            ('PE', 'Pernambuco'), ('PI', 'Piau√≠'), ('RJ', 'Rio de Janeiro'), ('RN', 'Rio Grande do Norte'),
                                            ('RS', 'Rio Grande do Sul'), ('RO', 'Rond√¥nia'), ('RR', 'Roraima'), ('SC', 'Santa Catarina'),
                                            ('SP', 'S√£o Paulo'), ('SE', 'Sergipe'), ('TO', 'Tocantins')
                                        ] %}
                                        {% for sigla, nome in estados %}
                                        <option value="{{ sigla }}" {{ 'selected' if vaga.localizacao_estado == sigla else '' }}>{{ nome }}</option>
                                        {% endfor %}
                                    </select>
                                </div>

                                <div class="md:col-span-2">
                                    <label for="localizacao_cep" class="block text-sm font-medium text-gray-700 mb-2">
                                        CEP
                                    </label>
                                    <input type="text" id="localizacao_cep" name="localizacao_cep"
                                           value="{{ vaga.localizacao_cep if vaga.localizacao_cep else '' }}"
                                           class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200"
                                           placeholder="Ex: 01234-567"
                                           pattern="[0-9]{5}-?[0-9]{3}">
                                </div>
                            </div>
                        </div>

                        <p class="text-xs text-gray-500 mt-2">
                            Obrigat√≥rio para vagas presenciais e h√≠bridas
                        </p>
                    </div>
                </div>

                <div>
                    <label for="descricao" class="block text-sm font-medium text-gray-700 mb-2">
                        Descri√ß√£o da Vaga *
                    </label>
                    <textarea id="descricao" name="descricao" required rows="4"
                              class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200">{{ vaga.descricao }}</textarea>
                </div>

                <div>
                    <label for="requisitos" class="block text-sm font-medium text-gray-700 mb-2">
                        Requisitos *
                    </label>
                    <textarea id="requisitos" name="requisitos" required rows="4"
                              class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200">{{ vaga.requisitos }}</textarea>
                </div>

                <div>
                    <label for="diferenciais" class="block text-sm font-medium text-gray-700 mb-2">
                        Diferenciais (Desej√°veis)
                        <span class="text-sm text-gray-500 font-normal">- Confidencial, n√£o ser√° exibido para candidatos</span>
                    </label>
                    <textarea id="diferenciais" name="diferenciais" rows="3"
                              class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200"
                              placeholder="Ex: Ingl√™s fluente, certifica√ß√µes espec√≠ficas, experi√™ncia em setores similares...">{{ vaga.diferenciais if vaga.diferenciais else '' }}</textarea>
                </div>

                <div class="flex gap-4 pt-6">
                    <button type="submit"
                            class="flex-1 bg-gradient-to-r from-purple-600 to-blue-600 text-white py-3 px-6 rounded-xl font-semibold hover:from-purple-700 hover:to-blue-700 transition-all duration-300 transform hover:scale-105 shadow-lg">
                        Atualizar Vaga
                    </button>
                    <a href="{{ url_for('dashboard_empresa') }}"
                       class="flex-1 bg-gray-500 text-white py-3 px-6 rounded-xl font-semibold hover:bg-gray-600 transition-all duration-300 text-center">
                        Cancelar
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
function toggleEnderecoField() {
    const tipoVaga = document.getElementById('tipo_vaga').value;
    const enderecoContainer = document.getElementById('endereco_container');
    const camposEndereco = document.querySelectorAll('#campos_endereco_vaga input, #campos_endereco_vaga select');

    if (tipoVaga === 'Presencial' || tipoVaga === 'H√≠brida') {
        enderecoContainer.classList.remove('hidden');
        camposEndereco.forEach(campo => {
            if (campo.id !== 'localizacao_cep') {
                campo.required = true;
            }
        });
    } else {
        enderecoContainer.classList.add('hidden');
        camposEndereco.forEach(campo => {
            campo.required = false;
        });
    }
}

function toggleNovaCategoria() {
    const categoriaSelect = document.getElementById('categoria_id');
    const novaContainer = document.getElementById('nova_categoria_container');
    const novaInput = document.getElementById('nova_categoria');

    if (categoriaSelect.value === 'nova') {
        novaContainer.classList.remove('hidden');
        novaInput.required = true;
        novaInput.focus();
    } else {
        novaContainer.classList.add('hidden');
        novaInput.required = false;
        novaInput.value = '';
    }
}

function toggleEnderecoEmpresa() {
    const checkbox = document.getElementById('usar_endereco_empresa');
    const camposEndereco = document.getElementById('campos_endereco_vaga');

    if (checkbox.checked) {
        // Buscar dados da empresa via AJAX
        fetch('/empresa/endereco')
            .then(response => response.json())
            .then(data => {
                if (data.endereco) {
                    document.getElementById('localizacao_endereco').value = data.endereco || '';
                    document.getElementById('localizacao_cidade').value = data.cidade || '';
                    document.getElementById('localizacao_estado').value = data.estado || '';
                    document.getElementById('localizacao_cep').value = data.cep || '';
                }
            })
            .catch(error => {
                console.error('Erro ao buscar endere√ßo da empresa:', error);
            });

        camposEndereco.style.opacity = '0.6';
        camposEndereco.style.pointerEvents = 'none';
    } else {
        camposEndereco.style.opacity = '1';
        camposEndereco.style.pointerEvents = 'auto';
    }
}

// M√°scara para CEP
document.getElementById('localizacao_cep').addEventListener('input', function(e) {
    let value = e.target.value.replace(/\D/g, '');
    if (value.length <= 8) {
        value = value.replace(/(\d{5})(\d)/, '$1-$2');
        e.target.value = value;
    }
});

// Inicializar estado dos campos ao carregar a p√°gina
document.addEventListener('DOMContentLoaded', function() {
    toggleEnderecoField();
    if (document.getElementById('usar_endereco_empresa').checked) {
        toggleEnderecoEmpresa();
    }
});
</script>
{% endblock %}
