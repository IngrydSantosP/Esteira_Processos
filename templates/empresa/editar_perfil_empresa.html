{% extends "base.html" %}

{% block title %}Editar Perfil da Empresa{% endblock %}

{% block content %}

<link rel="stylesheet" href="{{ url_for('static', filename='style/editar_perfil.css') }}">

<div class="form-container">

    <!-- Formulário -->
    <form method="POST"
          action="{{ url_for('vagas.editar_perfil_empresa') }}"
          enctype="multipart/form-data"
          class="form">

        <!-- Header -->
        <div class="form-header">
            <div class="header-content">
                <a href="{{ url_for('vagas.dashboard_empresa') }}" class="back-button">
                    <span class="back-arrow">x</span>
                </a>
            </div>

            <!-- Foto de perfil -->
        <div class="profile-container">
            
            <div class="image-upload-container">
                {% if empresa and empresa['imagem_perfil'] %}
                    <div class="profile-image">
                        <img src="{{ empresa['imagem_perfil'] }}" alt="Imagem atual" class="image-preview">
                    </div>
                {% endif %}
                <input type="file" id="imagem_perfil" name="imagem_perfil" accept="image/*" class="file-input">
            </div>
            <label for="imagem_perfil" class="label">Foto de Perfil</label>
            <div id="preview_imagem" class="preview"></div>
        </div>

        <!-- Informações da Empresa -->
        <h2 class="section-title">Informações</h2>
        <div class="form-grid">
            <div>
                <label for="nome" class="label">Nome da Empresa</label>
                <input type="text" id="nome" name="nome" value="{{ empresa['nome'] if empresa else '' }}" required class="input">
            </div>
            <div>
                <label for="email" class="label">E-mail</label>
                <input type="email" id="email" name="email" value="{{ empresa['email'] if empresa else '' }}" required class="input">
            </div>
        </div>

        <!-- Localização -->
        <h2 class="section-title">Localização</h2>
        <div class="form-grid">
            <div>
                <label for="cep" class="label">CEP</label>
                <input type="text" id="cep" name="cep" value="{{ empresa['cep'] if empresa else '' }}" class="input" onblur="aplicarBuscaEndereco()">
            </div>
            <div>
                <label for="endereco" class="label">Endereço</label>
                <input type="text" id="endereco" name="endereco" value="{{ empresa['endereco'] if empresa else '' }}" class="input">
            </div>
        </div>
        <div class="form-grid">
            <div>
                <label for="cidade" class="label">Cidade</label>
                <input type="text" id="cidade" name="cidade" value="{{ empresa['cidade'] if empresa else '' }}" class="input">
            </div>
            <div>
                <label for="estado" class="label">Estado</label>
                <input type="text" id="estado" name="estado" value="{{ empresa['estado'] if empresa else '' }}" class="input">
            </div>
        </div>

        <!-- Botões -->
        <div class="form-actions">
            <button type="submit" class="submit-button">
                <img src="{{ url_for('static', filename='/img/confirm.png') }}" class="emojis">
                Salvar Alterações
            </button>
        </div>
    </form>
</div>

<script>
function aplicarBuscaEndereco() {
    const cep = document.getElementById('cep').value.replace(/\D/g, '');
    if (cep.length === 8) {
        fetch(`https://viacep.com.br/ws/${cep}/json/`)
            .then(response => response.json())
            .then(data => {
                if (!data.erro) {
                    document.getElementById('endereco').value = data.logradouro || '';
                    document.getElementById('cidade').value = data.localidade || '';
                    document.getElementById('estado').value = data.uf || '';
                } else {
                    alert("CEP não encontrado.");
                }
            })
            .catch(error => console.error('Erro ao buscar o endereço:', error));
    } else {
        alert("CEP inválido.");
    }
}

// Preview da imagem antes de enviar
const inputImagem = document.getElementById('imagem_perfil');
const preview = document.getElementById('preview_imagem');

inputImagem.addEventListener('change', function () {
    const file = this.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function (e) {
            preview.innerHTML = `<img src="${e.target.result}" alt="Preview" class="image-preview"/>`;
        };
        reader.readAsDataURL(file);
    } else {
        preview.innerHTML = '';
    }
});
</script>

{% endblock %}
