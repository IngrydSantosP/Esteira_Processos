{% extends "base.html" %}

{% block title %}Candidatos da Vaga{% endblock %}

{% block head %}
    <link rel="stylesheet" href="{{ url_for('static', filename='style/cadastro.css') }}">
    <script src="{{ url_for('static', filename='script/empresa/candidato_vaga.js') }}"></script>
{% endblock %}


{% block content %}
<div class="min-h-screen bg-gradient-to-br from-purple-50 via-blue-50 to-indigo-50">
    <!-- Header -->
    <div class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-500 rounded-xl flex items-center justify-center">
                        <span class="text-white font-bold text-lg">👥</span>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
                            Candidatos - {{ vaga_titulo }}
                        </h1>
                        <p class="text-gray-500 text-sm">Gerencie e analise os candidatos desta vaga</p>
                    </div>
                </div>
                <a href="{{ url_for('vagas.dashboard_empresa') }}" 
                   class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-xl transition-all duration-300 flex items-center gap-2">
                    <span>⬅️</span>
                    Voltar ao Dashboard
                </a>
            </div>
        </div>
    </div>

    <div class="max-w-7xl mx-auto px-4 py-8">
        <!-- Filtros de Busca -->
        <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100 mb-8">
            <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                <span>🔍</span>
                Filtros de Busca
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Nome do Candidato</label>
                    <input type="text" id="searchName" placeholder="Buscar por nome..."
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Score Mínimo (%)</label>
                    <input type="number" id="searchScore" placeholder="Ex: 70" min="0" max="100"
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Ordenar por</label>
                    <select id="sortBy" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="score">Maior Score</option>
                        <option value="position">Melhor Posição</option>
                        <option value="name">Nome (A-Z)</option>
                    </select>
                </div>
            </div>

            <div class="flex gap-3">
                <button onclick="aplicarFiltros()" 
                        class="bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white px-6 py-3 rounded-xl font-semibold transition-all duration-300 transform hover:scale-105 flex items-center gap-2">
                    <span>🔍</span>
                    Aplicar Filtros
                </button>
                <button onclick="limparFiltros()" 
                        class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-6 py-3 rounded-xl font-semibold transition-all duration-300 transform hover:scale-105 flex items-center gap-2">
                    <span>🧹</span>
                    Limpar
                </button>
                <button onclick="toggleFavoritosOnly()" id="favoritosBtn"
                        class="bg-yellow-100 hover:bg-yellow-200 text-yellow-700 px-6 py-3 rounded-xl font-semibold transition-all duration-300 transform hover:scale-105 flex items-center gap-2">
                    <span>⭐</span>
                    Só Favoritos
                </button>
            </div>
        </div>

<!-- Lista de Candidatos -->
        <div id="candidatosList">
        {% if candidatos %}
        <div class="mb-6">
        <h3 class="text-xl font-bold text-gray-800 mb-2 flex items-center gap-2">
        <span>👥</span>
        Lista de Candidatos
        </h3>
        <p class="text-gray-600">Total: <span id="totalCandidatos">{{ candidatos|length }}</span> candidato(s)</p>
        </div>

        <div class="grid gap-6" id="candidatosGrid">
        {% for candidato in candidatos %}
        <div class="candidato-card group bg-white rounded-2xl p-6 shadow-sm border border-gray-100 hover:shadow-xl hover:border-blue-200 transition-all duration-300 transform hover:-translate-y-1"
        data-nome="{{ candidato.nome.lower() }}"
        data-score="{{ candidato.score }}"
        data-posicao="{{ candidato.posicao }}"
        data-candidato-id="{{ candidato.id }}"
        data-favorited="{{ 'true' if candidato.is_favorito else 'false' }}">
        <div class="flex flex-col lg:flex-row lg:items-center justify-between gap-6">
        <div class="flex-1">
        <div class="flex items-start gap-4">
        <div class="w-16 h-16 bg-gradient-to-br from-blue-100 to-purple-100 rounded-xl flex items-center justify-center flex-shrink-0">
            <span class="text-2xl">👤</span>
        </div>
        <div class="flex-1">
            <div class="flex items-center gap-3 mb-3">
                <h3 class="text-xl font-bold text-gray-800 group-hover:text-blue-600 transition-colors">
                    {{ candidato.nome }}
                </h3>
                <span class="favorito-badge bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full text-xs font-medium hidden">
                    ⭐ Favorito
                </span>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm text-gray-600">
                <div class="flex items-center gap-2">
                    <span>📧</span>
                    <span>{{ candidato.email }}</span>
                </div>
                {% if candidato.telefone %}
                <div class="flex items-center gap-2">
                    <span>📱</span>
                    <span>{{ candidato.telefone }}</span>
                </div>
                {% endif %}
                {% if candidato.endereco %}
                <div class="flex items-center gap-2">
                    <span>📍</span>
                    <span>{{ candidato.endereco }}</span>
                </div>
                {% endif %}
                {% if candidato.linkedin %}
                <div class="flex items-center gap-2">
                    <span>🔗</span>
                    <a href="{{ candidato.linkedin }}" target="_blank" 
                        class="text-blue-600 hover:text-blue-800 transition-colors">
                        LinkedIn
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
        </div>
        </div>

        <div class="flex flex-col items-center gap-4 lg:w-48">
        <div class="flex gap-3">
        <div class="text-center bg-gradient-to-r from-blue-500 to-purple-500 text-white px-4 py-3 rounded-xl shadow-md">
            <div class="text-lg font-bold">{{ candidato.posicao }}º</div>
            <div class="text-xs opacity-90">posição</div>
        </div>
        <div class="text-center bg-gradient-to-r from-green-500 to-emerald-500 text-white px-4 py-3 rounded-xl shadow-md cursor-pointer hover:bg-gradient-to-r hover:from-green-600 hover:to-emerald-600 transition-all"
                onclick="mostrarDetalhesScore('{{ candidato.id }}', '{{ candidato.nome }}', '{{ candidato.score }}')">
            <div class="text-lg font-bold">{{ "%.0f"|format(candidato.score) }}%</div>
            <div class="text-xs opacity-90">ver detalhes</div>
        </div>
        </div>

        <div class="flex gap-2">
       <button onclick="toggleFavoriteCandidato('{{ candidato.id }}', '{{ vaga_id }}', this)" 
                class="favorite-candidato-btn flex items-center gap-2 px-4 py-2 rounded-xl border border-yellow-400 bg-yellow-100 text-yellow-700 font-semibold transition-all duration-300 hover:bg-yellow-200 hover:text-yellow-800"
                data-candidato-id="{{ candidato.id }}" 
                data-favorited="{{ 'true' if candidato.is_favorito else 'false' }}">
            <span class="favorite-icon">⭐</span>
            <span class="favorite-text">Favoritar</span>
        </button>

        <a href="{{ url_for('candidaturas.baixar_curriculo', candidato_id=candidato.id) }}"
            class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-xl font-semibold transition-all duration-300 transform hover:scale-105 flex items-center gap-2">
            <span>📄</span>
            CV
        </a>
        </div>
        </div>
        </div>
        </div>
        {% endfor %}
        </div>
        {% else %}
        <div class="text-center py-12 bg-white rounded-2xl shadow-sm border border-gray-100">
        <div class="w-24 h-24 bg-gray-100 rounded-full mx-auto mb-6 flex items-center justify-center">
        <span class="text-4xl">👥</span>
        </div>
        <h3 class="text-xl font-bold text-gray-600 mb-3">Nenhum candidato ainda</h3>
        <p class="text-gray-500">Aguarde candidatos se inscreverem nesta vaga.</p>
        </div>
        {% endif %}
        </div>

    </div>
</div>



<!-- Modal de Detalhes do Score -->
<div id="modalScore" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
    <div class="bg-white rounded-2xl p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
        <div class="flex items-center justify-between mb-6">
            <h3 class="text-2xl font-bold text-gray-800 flex items-center gap-2">
                <span>📊</span> Detalhes do Score
            </h3>
            <button onclick="fecharModalScore()" class="text-gray-500 hover:text-gray-700 text-2xl">×</button>
        </div>
        
        <div id="conteudoScore" class="space-y-4">
            <!-- Conteúdo será preenchido via JavaScript -->
        </div>
        
        <div class="mt-6 flex justify-end">
            <button onclick="fecharModalScore()" 
                    class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-xl font-semibold transition-all">
                Fechar
            </button>
        </div>
    </div>
</div>

<!-- Incluir o modal de encerramento -->
{% include 'partials/modal_encerramento.html' %}
<script src="{{ url_for('static', filename='script/empresa/candidato_vaga.js') }}" defer></script>

{% endblock %}