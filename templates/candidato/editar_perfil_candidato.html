{% extends "base.html" %}

{% block title %}Editar Perfil{% endblock %}

{% block content %}

<link rel="stylesheet" href="{{ url_for('static', filename='style/editar_perfil.css') }}">
<div class="form-container">

    <form method="POST"
      action="{{ url_for('candidaturas.editar_perfil_candidato') }}"
      enctype="multipart/form-data"
      class="form">

        <!-- Header -->
        <div class="form-header">
            <div class="header-content">
                <a href="{{ url_for('candidaturas.dashboard_candidato') }}" class="back-button">
                    <span class="back-arrow">x</span>
                </a>
            </div>

            <!-- Foto de perfil -->
            <div class="profile-container">

                <div class="image-upload-container">
                    {% if candidato and candidato['imagem_perfil'] %}
                        <div class="profile-image">
                            <img src="{{ candidato['imagem_perfil'] }}" alt="Imagem atual" class="image-preview">
                        </div>
                
                    {% endif %} 
                    <input type="file" id="imagem_perfil" name="imagem_perfil" accept="image/*" class="file-input">
                </div>    
                <label for="imagem_perfil" class="label">Foto de Perfil</label>
                <div id="preview_imagem" class="preview"></div>
            </div>

        <!-- Informações Pessoais -->
        <h2 class="section-title">
            <img src="{{ url_for('static', filename='/img/nothing.png') }}" class="emojis">
            Informações Pessoais
        </h2>
        <div class="form-grid">
            <div>
                <label for="nome" class="label">Nome Completo</label>
                <input type="text" id="nome" name="nome" value="{{ candidato['nome'] if candidato else '' }}" required class="input">
            </div>
            <div>
                <label for="telefone" class="label">Telefone</label>
                <input type="tel" id="telefone" name="telefone" value="{{ candidato['telefone'] if candidato else '' }}" required class="input">
            </div>
        </div>

        <!-- Informações Profissionais -->
        <h2 class="section-title">
            <img src="{{ url_for('static', filename='/img/case.png') }}" class="emojis">
            Informações Profissionais
        </h2>
        <div class="form-grid">
            <div>
                <label for="linkedin" class="label">LinkedIn</label>
                <input type="url" id="linkedin" name="linkedin" value="{{ candidato['linkedin'] if candidato else '' }}" required class="input">
            </div>
            <div>
                <label for="pretensao_salarial" class="label">Pretensão Salarial (R$)</label>
                <input type="number" id="pretensao_salarial" name="pretensao_salarial" value="{{ candidato['pretensao_salarial'] if candidato else '' }}" step="0.01" required class="input">
            </div>
        </div>

        <!-- Textareas -->
        <div class="textarea-group">
            <label for="experiencia" class="label">Experiência Profissional</label>
            <textarea id="experiencia" name="experiencia" rows="4" class="textarea">{{ candidato['experiencia'] if candidato else '' }}</textarea>

            <label for="competencias" class="label">Competências e Habilidades</label>
            <textarea id="competencias" name="competencias" rows="3" class="textarea">{{ candidato['competencias'] if candidato else '' }}</textarea>

            <label for="resumo_profissional" class="label">Resumo Profissional</label>
            <textarea id="resumo_profissional" name="resumo_profissional" rows="3" class="textarea">{{ candidato['resumo_profissional'] if candidato else '' }}</textarea>

            <label for="formacao" class="label">Formação Acadêmica</label>
            <textarea id="formacao" name="formacao" rows="3" class="textarea">{{ candidato['formacao'] if candidato else '' }}</textarea>

            <label for="certificacoes" class="label">Certificações e Cursos</label>
            <textarea id="certificacoes" name="certificacoes" rows="3" class="textarea">{{ candidato['certificacoes'] if candidato else '' }}</textarea>

            <label for="idiomas" class="label">Idiomas</label>
            <textarea id="idiomas" name="idiomas" rows="2" class="textarea">{{ candidato['idiomas'] if candidato else '' }}</textarea>

            <label for="disponibilidade" class="label">Modalidade Preferida</label>
            <select id="disponibilidade" name="disponibilidade" class="input">
                <option value="">Selecione...</option>
                <option value="Presencial" {% if candidato and candidato['disponibilidade']=='Presencial' %}selected{% endif %}>Presencial</option>
                <option value="Remoto" {% if candidato and candidato['disponibilidade']=='Remoto' %}selected{% endif %}>Remoto</option>
                <option value="Híbrido" {% if candidato and candidato['disponibilidade']=='Híbrido' %}selected{% endif %}>Híbrido</option>
            </select>

            <label for="beneficios_desejados" class="label">Benefícios Desejados</label>
            <textarea id="beneficios_desejados" name="beneficios_desejados" rows="2" class="textarea">{{ candidato['beneficios_desejados'] if candidato else '' }}</textarea>
        </div>

        <!-- Endereço -->
        <h2 class="section-title">
            <img src="{{ url_for('static', filename='/img/maps.png') }}" class="emojis">
            Endereço
        </h2>
        <div class="form-grid">
            <div>
                <label for="cep" class="label">CEP</label>
                <input type="text" id="cep" name="cep" value="{{ candidato['cep'] if candidato else '' }}" class="input" onblur="aplicarBuscaEndereco()">
            </div>
            <div>
                <label for="endereco" class="label">Endereço</label>
                <input type="text" id="endereco" name="endereco" value="{{ candidato['endereco'] if candidato else '' }}" class="input">
            </div>
        </div>
        <div class="form-grid">
            <div>
                <label for="numero" class="label">Número</label>
                <input type="text" id="numero" name="numero" value="{{ candidato['numero'] if candidato else '' }}" class="input">
            </div>
            <div>
                <label for="complemento" class="label">Complemento</label>
                <input type="text" id="complemento" name="complemento" value="{{ candidato['complemento'] if candidato else '' }}" class="input">
            </div>
        </div>

        <!-- Botões -->
        <div class="form-actions">
            <div class="button-group">
                <button type="submit" class="submit-button">
                    <img src="{{ url_for('static', filename='/img/confirm.png') }}" class="emojis">
                    Salvar Alterações
                </button>
                <a href="{{ url_for('candidaturas.upload_curriculo') }}" class="upload-cv-button">
                    <img src="{{ url_for('static', filename='/img/report.png') }}" class="emojis">
                    Atualizar Currículo
                </a>
            </div>
        </div>
    </form>
</div>

<script>
function aplicarBuscaEndereco() {
    const cep = document.getElementById('cep').value.replace(/\D/g, '');
    if (cep.length === 8) {
        fetch(`https://viacep.com.br/ws/${cep}/json/`)
            .then(response => response.json())
            .then(data => {
                if (!data.erro) {
                    document.getElementById('endereco').value = data.logradouro;
                    document.getElementById('complemento').value = data.complemento || '';
                } else {
                    alert("CEP não encontrado.");
                }
            })
            .catch(error => console.error('Erro ao buscar o endereço:', error));
    }
}

// Preview da imagem
const inputImagem = document.getElementById('imagem_perfil');
const preview = document.getElementById('preview_imagem');

inputImagem.addEventListener('change', function () {
    const file = this.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function (e) {
            preview.innerHTML = `<img src="${e.target.result}" alt="Preview" class="image-preview"/>`;
        };
        reader.readAsDataURL(file);
    } else {
        preview.innerHTML = '';
    }
});
</script>

{% endblock %}
